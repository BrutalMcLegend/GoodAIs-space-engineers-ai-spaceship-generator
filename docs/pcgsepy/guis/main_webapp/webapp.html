<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>pcgsepy.guis.main_webapp.webapp API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pcgsepy.guis.main_webapp.webapp</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import base64
import json
import logging
import os
import random
import sys
import time
import uuid
from datetime import datetime
from typing import Any, Dict, List, Optional, Tuple
from zipfile import ZipFile

from pcgsepy.guis.voxel import VoxelData

if getattr(sys, &#39;frozen&#39;, False) and hasattr(sys, &#39;_MEIPASS&#39;):
    os.chdir(sys._MEIPASS)
    curr_folder = os.path.dirname(sys.executable)
else:
    curr_folder = sys.path[0]

import dash
import dash_bootstrap_components as dbc
import numpy as np
import plotly.graph_objects as go
from dash import ALL, dcc, html
from dash.dependencies import Input, Output, State
from pcgsepy.common.api_call import block_definitions
from pcgsepy.common.jsonifier import json_dumps
from pcgsepy.common.vecs import Vec
from pcgsepy.config import (MY_EMITTERS, N_EMITTER_STEPS, N_GENS_ALLOWED)
from pcgsepy.guis.main_webapp.modals_msgs import (end_of_experiment,
                                                  end_of_userstudy,
                                                  no_selection_error,
                                                  privacy_policy_body,
                                                  privacy_policy_question,
                                                  spaceship_population_help,
                                                  spaceship_preview_help,
                                                  download_help,
                                                  user_study_quit_msg)
from pcgsepy.guis.utils import AppMode, AppSettings, DashLoggerHandler, Metric, Semaphore
from pcgsepy.hullbuilder import HullBuilder
from pcgsepy.lsystem.rules import StochasticRules
from pcgsepy.lsystem.solution import CandidateSolution
from pcgsepy.mapelites.bin import MAPBin
from pcgsepy.mapelites.emitters import (ContextualBanditEmitter, Emitter,
                                        GreedyEmitter, HumanEmitter,
                                        HumanPrefMatrixEmitter, KNNEmitter, LinearKernelEmitter,
                                        PreferenceBanditEmitter, RBFKernelEmitter, RandomEmitter,
                                        emitters)
from pcgsepy.mapelites.map import MAPElites, get_elite
from pcgsepy.structure import _is_base_block, _is_transparent_block
from pcgsepy.xml_conversion import convert_structure_to_xml
from tqdm import trange


dashLoggerHandler = DashLoggerHandler()
logging.getLogger(&#39;webapp&#39;).addHandler(dashLoggerHandler)


base_color: Vec = Vec.v3f(0.45, 0.45, 0.45)
block_to_colour: Dict[str, str] = {
    # colours from https://developer.mozilla.org/en-US/docs/Web/CSS/color_value
    &#39;LargeBlockArmorCorner&#39;: &#39;#737373&#39;,
    &#39;LargeBlockArmorSlope&#39;: &#39;#737373&#39;,
    &#39;LargeBlockArmorCornerInv&#39;: &#39;#737373&#39;,
    &#39;LargeBlockArmorBlock&#39;: &#39;#737373&#39;,
    &#39;LargeBlockGyro&#39;: &#39;#2f4f4f&#39;,
    &#39;LargeBlockSmallGenerator&#39;: &#39;#ffa07a&#39;,
    &#39;LargeBlockSmallContainer&#39;: &#39;#008b8b&#39;,
    &#39;OpenCockpitLarge&#39;: &#39;#32cd32&#39;,
    &#39;LargeBlockSmallThrust&#39;: &#39;#ff8c00&#39;,
    &#39;SmallLight&#39;: &#39;#fffaf0&#39;,
    &#39;Window1x1Slope&#39;: &#39;#fffff0&#39;,
    &#39;Window1x1Flat&#39;: &#39;#fffff0&#39;,
    &#39;LargeBlockLight_1corner&#39;: &#39;#fffaf0&#39;,
    &#39;Unrecognized&#39;: &#39;#ff0000&#39;,
    &#39;Air&#39;: &#39;#000000&#39;
}
hidden_style: Dict[str, str] = {&#39;visibility&#39;: &#39;hidden&#39;, &#39;height&#39;: &#39;0px&#39;, &#39;display&#39;: &#39;none&#39;}
circle_style: Dict[str, str] = {
        &#39;height&#39;: &#39;10px&#39;,
        &#39;width&#39;: &#39;10px&#39;,
        &#39;border-radius&#39;: &#39;50%&#39;,
        &#39;vertical-align&#39;: &#39;middle&#39;,
        &#39;margin&#39;: &#39;0 5px 0 0&#39;
}
struct_sizes: Dict[int, str] = {1: &#39;Small&#39;,
                                2: &#39;Normal&#39;,
                                5: &#39;Large&#39;}       


app_settings = AppSettings()


n_spaceships_inspected = Metric(name=&#39;n_spaceships_inspected&#39;,
                                emitters=app_settings.my_emitterslist,
                                exp_n=app_settings.exp_n)
time_elapsed_user = Metric(name=&#39;time_elapsed_user&#39;,
                           emitters=app_settings.my_emitterslist,
                           exp_n=app_settings.exp_n,
                           multiple_values=True)
time_elapsed_emitter = Metric(name=&#39;time_elapsed_emitter&#39;,
                              emitters=app_settings.my_emitterslist,
                              exp_n=app_settings.exp_n,
                              multiple_values=True)
population_complexity = Metric(name=&#39;population_complexity&#39;,
                               emitters=app_settings.my_emitterslist,
                               exp_n=app_settings.exp_n,
                               multiple_values=True)
n_solutions_feas = Metric(name=&#39;n_solutions_feas&#39;,
                          emitters=app_settings.my_emitterslist,
                          exp_n=app_settings.exp_n)
n_solutions_infeas = Metric(name=&#39;n_solutions_infeas&#39;,
                            emitters=app_settings.my_emitterslist,
                            exp_n=app_settings.exp_n)


all_metrics = [n_spaceships_inspected,
               time_elapsed_user,
               time_elapsed_emitter,
               population_complexity,
               n_solutions_feas,
               n_solutions_infeas]


download_semaphore = Semaphore(locked=True)    
process_semaphore = Semaphore()


def resource_path(relative_path):
# get absolute path to resource
    try:
        # PyInstaller creates a temp folder and stores path in _MEIPASS
        base_path = sys._MEIPASS
    except Exception:
        base_path = os.path.abspath(&#34;.&#34;)
    return os.path.join(base_path, relative_path)


app = dash.Dash(__name__,
                title=&#39;AI Spaceship Generator&#39;,
                external_stylesheets=[dbc.themes.DARKLY],
                assets_folder=resource_path(&#34;assets&#34;),
                update_title=None)


def get_properties_table(cs: Optional[CandidateSolution] = None) -&gt; dbc.Table:
    size = str(cs.size) if cs else &#39;-&#39; 
    nblocks = cs.n_blocks if cs else &#39;-&#39;
    vol = cs.content.total_volume if cs else &#39;-&#39;
    mass = cs.content.mass if cs else &#39;-&#39;
    struct_size = struct_sizes[cs.content.grid_size] if cs else &#39;-&#39;
    armor_blocks, non_armor_blocks = cs.content.blocks_count if cs else (&#39;-&#39;, &#39;-&#39;)
    cs_unique_blocks = cs.unique_blocks if cs else {}
    
    table_header = [
        html.Thead(html.Tr([html.Th(&#34;Property&#34;, style={&#39;text-align&#39;: &#39;center&#39;}),
                            html.Th(&#34;Value&#34;, style={&#39;text-align&#39;: &#39;center&#39;})]))
        ]
    table_body = [html.Tbody([
        html.Tr([html.Td(&#34;Spaceship size&#34;), html.Td(f&#39;{size} m&#39;, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Grid size&#34;), html.Td(struct_size, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Number of blocks&#34;), html.Td(nblocks, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Armor blocks&#34;), html.Td(armor_blocks, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Non-armor blocks&#34;), html.Td(non_armor_blocks, style={&#39;text-align&#39;: &#39;center&#39;})]),
        *[html.Tr([html.Td(k), html.Td(v, style={&#39;text-align&#39;: &#39;center&#39;})]) for k, v in cs_unique_blocks.items()],
        html.Tr([html.Td(&#34;Occupied volume&#34;), html.Td(f&#39;{vol} m³&#39;, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Spaceship mass&#34;), html.Td(f&#39;{mass} kg&#39;, style={&#39;text-align&#39;: &#39;center&#39;})]),
    ])]
    
    return table_header + table_body


def get_content_legend() -&gt; dbc.Row:
    return dbc.Row([
        dbc.Col(children=[
            html.Span(children=[
                html.P(&#39;&#39;, style={**circle_style,
                                  **{&#39;background-color&#39;: &#39;#%02x%02x%02x&#39; % base_color.scale(256).to_veci().as_tuple() if _is_base_block(block_type) else block_to_colour[block_type]}}),
                dbc.Label(block_type,
                          align=&#39;start&#39;,
                        #   style={&#39;text-overflow&#39;: &#39;ellipsis&#39;, &#39;text-align&#39;: &#39;left&#39;, &#39;font-size&#39;: &#39;x-small&#39;}
                          )],
                      style={&#39;display&#39;: &#39;inline-flex&#39;, &#39;align-items&#39;: &#39;baseline&#39;, &#39;font-size&#39;: &#39;x-small&#39;, &#39;text-align&#39;: &#39;left&#39;}
                      ),
            ],
                style={&#39;overflow&#39;: &#39;hidden&#39;, &#39;text-overflow&#39;: &#39;ellipsis&#39;, &#39;display&#39;: &#39;block&#39;, &#39;white-space&#39;: &#39;nowrap&#39;},
                width=3) for block_type in block_to_colour.keys()
        ],
                   justify=&#39;start&#39;)


def _get_emitter() -&gt; Emitter:
    curr_emitter = app_settings.my_emitterslist[app_settings.exp_n].replace(&#39;.json&#39;, &#39;&#39;).split(&#39;_&#39;)[1]
    if curr_emitter == &#39;human&#39;:
        return HumanEmitter()
    elif curr_emitter == &#39;random&#39;:
        return RandomEmitter()
    elif curr_emitter == &#39;greedy&#39;:
        return GreedyEmitter()
    elif curr_emitter == &#39;contbandit&#39;:
        return ContextualBanditEmitter()
    else:
        raise ValueError(f&#39;Unexpected emitter type: {curr_emitter} (from &#34;{app_settings.my_emitterslist[app_settings.exp_n]}&#34;&#39;)
   
 
def serve_layout() -&gt; dbc.Container:
    global app_settings
    
    if not app_settings.app_mode:
        app_settings.consent_ok = False if app_settings.app_mode == AppMode.DEV else None
    
    # check if user has completed the user study already
    if not app_settings.app_mode:
        if os.path.isfile(os.path.join(curr_folder, &#39;.userstudyover&#39;)):
            app_settings.consent_ok = False
            app_settings.app_mode = AppMode.USER
    
    
    webapp_info_file = &#39;./assets/webapp_help_dev.md&#39; if app_settings.app_mode == AppMode.DEV else &#39;./assets/webapp_info.md&#39;
    with open(webapp_info_file, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
        webapp_info_str = f.read()
        
    algo_info_file = &#39;./assets/algo_info.md&#39;
    with open(algo_info_file, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
        algo_info_str = f.read()
    
    quickstart_info_file = &#39;./assets/quickstart.md&#39;
    with open(quickstart_info_file, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
        quickstart_info_str = f.read()
    
    quickstart_usermode_info_file = &#39;./assets/quickstart_usermode.md&#39;
    with open(quickstart_usermode_info_file, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
        quickstart_usermode_info_str = f.read()
    
    if app_settings.rngseed is None:
        app_settings.rngseed = uuid.uuid4().int
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Your ID is {app_settings.rngseed}.&#39;)
    if app_settings.app_mode is None:
        random.seed(app_settings.rngseed)
        app_settings.my_emitterslist = MY_EMITTERS.copy()
        random.shuffle(app_settings.my_emitterslist)
        app_settings.current_mapelites.emitter = _get_emitter()
        logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}.set_app_layout] {app_settings.app_mode=} {app_settings.rngseed=}; {app_settings.my_emitterslist=}.&#39;)
        
    consent_dialog = dbc.Modal([
            dbc.ModalHeader(dbc.ModalTitle(&#34;Privacy Policy&#34;),
                            style={&#39;justify-content&#39;: &#39;center&#39;},
                            close_button=False),
            dbc.ModalBody(children=[
                html.Div(id=&#39;body-text&#39;,
                         children=[
                              dcc.Markdown(privacy_policy_body,
                                           link_target=&#34;_blank&#34;,
                                           style={&#39;text-align&#39;: &#39;justify&#39;}),
                              dcc.Markdown(privacy_policy_question,
                                           style={&#39;text-align&#39;: &#39;center&#39;})
                         ]),
                html.Div(id=&#39;consent-body-loading&#39;,
                         children=[])
            ]),
            dbc.ModalFooter(children=[
                dbc.Button(&#34;No&#34;,
                           disabled=False,
                           id=&#34;consent-no&#34;,
                           color=&#34;danger&#34;,
                           className=&#34;ms-auto&#34;,
                           n_clicks=0,
                           style={&#39;width&#39;: &#39;49%&#39;}),
                dbc.Button(&#34;Yes, and take me to the questionnaire&#34;,
                           disabled=False,
                           id=&#34;consent-yes&#34;,
                           color=&#34;success&#34;,
                           className=&#34;ms-auto&#34;,
                           n_clicks=0,
                           style={&#39;width&#39;: &#39;49%&#39;})
                ])
            ],
        id=&#34;consent-modal&#34;,
        centered=True,
        backdrop=&#34;static&#34;,
        keyboard=False,
        is_open=False)
    
    webapp_info_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;App Info&#34;),
                        style={&#39;flex-direction&#39;: &#39;column-reverse&#39;},
                        close_button=True),
        dbc.ModalBody(dcc.Markdown(webapp_info_str,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
        ],
                           id=&#39;webapp-info-modal&#39;,
                           centered=True,
                           backdrop=&#39;static&#39;,
                           is_open=False,
                           scrollable=True,
                           size=&#39;lg&#39;)
    
    algo_info_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;AI Info&#34;),
                        style={&#39;flex-direction&#39;: &#39;column-reverse&#39;},
                        close_button=True),
        dbc.ModalBody(dcc.Markdown(algo_info_str,
                                   style={&#39;text-align&#39;: &#39;justify&#39;},
                                   mathjax=True))
    ],
                           id=&#39;algo-info-modal&#39;,
                           centered=True,
                           backdrop=&#39;static&#39;,
                           is_open=False,
                           scrollable=True,
                           size=&#39;lg&#39;)
    
    quickstart_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Tutorial&#34;),
                        style={&#39;flex-direction&#39;: &#39;column-reverse&#39;},
                        close_button=True),
        dbc.ModalBody(dcc.Markdown(quickstart_info_str,
                                   link_target=&#34;_blank&#34;,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
    ],
                           id=&#39;quickstart-modal&#39;,
                           centered=True,
                           backdrop=&#39;static&#39;,
                           is_open=False,
                           scrollable=True,
                           size=&#39;lg&#39;)
    
    quickstart_usermode_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Tutorial&#34;),
                        style={&#39;flex-direction&#39;: &#39;column-reverse&#39;},
                        close_button=True),
        dbc.ModalBody(dcc.Markdown(quickstart_usermode_info_str,
                                   link_target=&#34;_blank&#34;,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
    ],
                           id=&#39;quickstart-usermode-modal&#39;,
                           centered=True,
                           backdrop=&#39;static&#39;,
                           is_open=False,
                           scrollable=True,
                           size=&#39;lg&#39;)

    no_bins_selected_modal = dbc.Modal(children=[
        dbc.ModalHeader(dbc.ModalTitle(&#34;⚠ Warning ⚠&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(no_selection_error),
        dbc.ModalFooter(children=[dbc.Button(&#34;Ok&#34;,
                                             id=&#34;nbs-err-btn&#34;,
                                             color=&#34;primary&#34;,
                                             className=&#34;ms-auto&#34;,
                                             n_clicks=0)]),
        ],
                                       id=&#39;nbs-err-modal&#39;,
                                       centered=True,
                                       backdrop=True,
                                       is_open=False)
    
    end_of_experiment_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;End of Generation&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(dcc.Markdown(end_of_experiment,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
    ],
                           id=&#39;eoe-modal&#39;,
                           centered=True,
                           backdrop=True,
                           is_open=False,
                           scrollable=True)
    
    end_of_userstudy_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;End of User Study&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(children=[
            dcc.Markdown(end_of_userstudy,
                         style={&#39;text-align&#39;: &#39;justify&#39;}),
            html.Div(id=&#39;eous-body-loading&#39;,
                     children=[])
            ])
        ],
                                       id=&#39;eous-modal&#39;,
                                       centered=True,
                                       backdrop=True,
                                       is_open=False,
                                       scrollable=True)
    
    heatmap_help_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Spaceship Population Help&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(dcc.Markdown(spaceship_population_help,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
        ],
                                   id=&#39;hh-modal&#39;,
                                   centered=True,
                                   backdrop=True,
                                   is_open=False,
                                   scrollable=True)
    
    content_help_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Selected Spaceship Help&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(dcc.Markdown(spaceship_preview_help,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
        ],
                                   id=&#39;ch-modal&#39;,
                                   centered=True,
                                   backdrop=True,
                                   is_open=False,
                                   scrollable=True)
    
    download_help_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Download Help&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(dcc.Markdown(download_help,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
        ],
                                   id=&#39;dh-modal&#39;,
                                   centered=True,
                                   backdrop=True,
                                   is_open=False,
                                   scrollable=True)
    
    exit_userstudy_modal = dbc.Modal(children=[
        dbc.ModalHeader(dbc.ModalTitle(&#34;Quit User Study?&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=True),
        dbc.ModalBody(children=[
            dcc.Markdown(user_study_quit_msg,
                         style={&#39;text-align&#39;: &#39;justify&#39;}),
            html.Div(id=&#39;eus-body-loading&#39;,
                     children=[])
        ]),       
        dbc.ModalFooter(children=[dbc.Button(&#34;Yes&#34;,
                                             id=&#34;qus-y-btn&#34;,
                                             color=&#34;primary&#34;,
                                             className=&#34;ms-auto&#34;,
                                             n_clicks=0,
                                             style={&#39;width&#39;: &#39;100%&#39;})])
        ],
                                     id=&#39;eus-modal&#39;,
                                     centered=True,
                                     backdrop=True,
                                     is_open=False,
                                     scrollable=True)
    
    modals = html.Div(children=[
        consent_dialog, webapp_info_modal, algo_info_modal, quickstart_modal, quickstart_usermode_modal,
        no_bins_selected_modal, end_of_experiment_modal, end_of_userstudy_modal, exit_userstudy_modal,
        heatmap_help_modal, content_help_modal, download_help_modal
    ])
    
    header = dbc.Row(children=[
                dbc.Col(html.H1(children=[
                    html.Span(children=&#39;Space Engineers&#39;),
                    html.Br(),
                    html.Span(children=&#39;🚀AI Spaceship Generator🚀&#39;)
                    ],
                                className=&#39;title&#39;),
                        width={&#39;size&#39;: 6,
                               &#39;offset&#39;: 3
                               },
                        style={
                            &#39;display&#39;: &#39;inline-flex&#39;,
                            &#39;flex-direction&#39;: &#39;column&#39;,
                            &#39;align-content&#39;: &#39;center&#39;,
                            &#39;justify-content&#39;: &#39;center&#39;,
                            &#39;align-items&#39;: &#39;center&#39;
                            }),
                dbc.Col(children=[
                    dbc.Row(children=[
                        dbc.Col(dbc.Button(&#39;Tutorial&#39;,
                                           className=&#39;button-fullsize&#39;,
                                           id=&#39;webapp-quickstart-btn&#39;,
                                           color=&#39;info&#39;),
                                width=4,
                                style=hidden_style if app_settings.app_mode == AppMode.DEV else {}),
                        dbc.Col(dbc.Button(&#39;App Info&#39;,
                                           className=&#39;button-fullsize&#39;,
                                           id=&#39;webapp-info-btn&#39;,
                                           color=&#39;info&#39;),
                                width=4),
                        dbc.Col(dbc.Button(&#39;AI Info&#39;,
                                           className=&#39;button-fullsize&#39;,
                                           id=&#39;ai-info-btn&#39;,
                                           color=&#39;info&#39;),
                                width=4)
                        ],
                            align=&#39;center&#39;)],
                        align=&#39;center&#39;, width=2)
    ],
                     className=&#39;header&#39;,
                     style={&#39;content-justify&#39;: &#39;center&#39;})
    
    quit_user_study_div = html.Div(
        dbc.Row(
                dbc.Col(children=[
                    dbc.Button(&#39;Quit User Study&#39;,
                               id=&#39;qus-btn&#39;,
                               className=&#39;button-fullsize&#39;,
                               color=&#39;danger&#39;),
                    html.Br(),
                    html.Br()],
                        width={&#39;size&#39;: 2, &#39;offset&#39;: 5}),
                id=&#39;qus-div&#39;,
                style={&#39;text-align&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.USERSTUDY else hidden_style
                )
    )
    
    exp_progress = html.Div(
        id=&#39;study-progress-div&#39;,
        children=[
            dbc.Row(
                dbc.Col(children=[
                    dbc.Label(f&#39;Current Iteration&#39;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                dbc.Progress(id=&#34;gen-progress&#34;,
                             color=&#39;success&#39;,
                             striped=False,
                             animated=False)
                ],
                        width={&#39;size&#39;: 12, &#39;offset&#39;: 0},
                        style={&#39;text-align&#39;: &#39;center&#39;},
                        align=&#39;center&#39;)
            ),
            
            dbc.Row(
                dbc.Col(children=[
                    dbc.Label(f&#39;Spaceships Generation Progress&#39;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                    dbc.Progress(id=&#34;exp-progress&#34;,
                                 color=&#39;success&#39;,
                                 striped=False,
                                 animated=False)
                ],
                        width={&#39;size&#39;: 12, &#39;offset&#39;: 0},
                        style={&#39;text-align&#39;: &#39;center&#39;} if app_settings.app_mode is None else {**{&#39;text-align&#39;: &#39;center&#39;}, **hidden_style},
                        align=&#39;center&#39;,
                        id=&#39;exp-progress-div&#39;)
            )
        ])
    
    mapelites_heatmap = html.Div(children=[
        
        html.Div(children=[
                html.H4(&#39;Spaceship Population&#39;,
                        className=&#39;section-title&#39;),
                dbc.Button(&#39;🛈&#39;,
                           color=&#39;info&#39;,
                           id=&#39;heatmap-help&#39;,
                           className=&#39;help&#39;),
                ],
                  style={
                      &#39;display&#39;: &#39;inline-flex&#39;,
                      &#39;flex-direction&#39;: &#39;row&#39;,
                      &#39;justify-content&#39;: &#39;center&#39;,
                      &#39;align-content&#39;: &#39;center&#39;,
                      &#39;align-items&#39;: &#39;center&#39;,
                      &#39;text-align&#39;: &#39;center&#39;
                      }),
        
        html.Br(),
        html.Div(className=&#39;container&#39;,
                 children=[
                     dcc.Graph(id=&#34;heatmap-plot&#34;,
                               figure=go.Figure(data=[]),
                               config={
                                   &#39;displayModeBar&#39;: False,
                                   &#39;displaylogo&#39;: False,
                                   &#39;scrollZoom&#39;: True},
                               className=&#39;content&#39;,
                               style={&#39;z-index&#39;: 0, &#39;overflow&#39;: &#39;auto&#39;}),
                     html.Div(id=&#39;heatmap-plot-container&#39;,
                              className=&#39;overlay&#39;,
                              style={&#39;visibility&#39;: &#39;hidden&#39;,
                                     &#39;display&#39;: &#39;none&#39;,
                                     &#39;pointer-events&#39;: &#39;auto&#39;,
                                     &#39;z-index&#39;: 1}),
                 ])
        ],
                                 style={&#39;text-align&#39;: &#39;center&#39;})
    
    mapelites_controls = html.Div(
        children=[
            html.H4(children=&#39;Plot Settings&#39;,
                    className=&#39;section-title&#39;),
            html.Br(),
            dbc.Label(&#39;Choose which population to display.&#39;),
            dbc.DropdownMenu(label=&#39;Feasible&#39;,
                            children=[
                                dbc.DropdownMenuItem(&#39;Feasible&#39;, id=&#39;population-feasible&#39;),
                                dbc.DropdownMenuItem(&#39;Infeasible&#39;, id=&#39;population-infeasible&#39;),
                            ],
                            id=&#39;population-dropdown&#39;),
            html.Br(),
            dbc.Label(&#39;Choose which metric to plot.&#39;),
            dbc.DropdownMenu(label=&#39;Fitness&#39;,
                            children=[
                                dbc.DropdownMenuItem(&#39;Fitness&#39;, id=&#39;metric-fitness&#39;),
                                dbc.DropdownMenuItem(&#39;Age&#39;, id=&#39;metric-age&#39;),
                                dbc.DropdownMenuItem(&#39;Coverage&#39;, id=&#39;metric-coverage&#39;),
                            ],
                            id=&#39;metric-dropdown&#39;),
            html.Br(),
            dbc.Label(&#39;Choose whether to compute the metric for the entire bin population or just the elite.&#39;),
            dbc.RadioItems(id=&#39;method-radio&#39;,
                        options=[
                            {&#39;label&#39;: &#39;Population&#39;, &#39;value&#39;: &#39;Population&#39;},
                            {&#39;label&#39;: &#39;Elite&#39;, &#39;value&#39;: &#39;Elite&#39;}
                        ],
                        value=&#39;Population&#39;)
            ],
        style=hidden_style if not app_settings.app_mode == AppMode.DEV else {})
    
    content_plot = html.Div(children=[
        
        html.Div(children=[
                html.H4(&#39;Selected Spaceship&#39;,
                        className=&#39;section-title&#39;),
                dbc.Button(&#39;🛈&#39;,
                           color=&#39;info&#39;,
                           id=&#39;content-help&#39;,
                           className=&#39;help&#39;)
            ],
                  style={
                      &#39;display&#39;: &#39;inline-flex&#39;,
                      &#39;flex-direction&#39;: &#39;row&#39;,
                      &#39;justify-content&#39;: &#39;center&#39;,
                      &#39;align-content&#39;: &#39;center&#39;,
                      &#39;align-items&#39;: &#39;center&#39;,
                      &#39;text-align&#39;: &#39;center&#39;
                      }),
        
        html.Br(),
        dcc.Graph(id=&#34;content-plot&#34;,
                  figure=go.Figure(data=[]),
                  config={
                      &#39;displayModeBar&#39;: False,
                      &#39;displaylogo&#39;: False},
                  style={&#39;overflow&#39;: &#39;auto&#39;}),
        html.Div(children=[
            dbc.Switch(
                    id=&#34;voxel-preview-toggle&#34;,
                    label=&#34;Toggle Voxel Preview&#34;,
                    value=False,
                )
            ],
                 style={&#39;display&#39;: &#39;inline-flex&#39;, &#39;justify-content&#39;: &#39;center&#39;}
                 ),
        html.Br(),
        dbc.Label(&#39;Legend&#39;,
                  size=&#39;sm&#39;),
        html.Div(children=[
            get_content_legend()
            ],
                 id=&#39;content-legend-div&#39;,
                 style={
                     &#39;text-align&#39;: &#39;start&#39;,
                     &#39;border-width&#39;: &#39;thin&#39;,
                     &#39;border-color&#39;: &#39;whitesmoke&#39;,
                     &#39;border-style&#39;: &#39;inset&#39;                     
                     })
        ],
                            style={&#39;text-align&#39;: &#39;center&#39;})
    
    color_and_download = html.Div(
        children=[
            dbc.Row(
                dbc.Col([
                    dbc.Label(&#34;Spaceship Color&#34;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                    dbc.Row(children=[
                        dbc.Col(
                            dbc.Input(type=&#34;color&#34;,
                                      id=&#34;color-picker&#34;,
                                      value=&#34;#737373&#34;,
                                      size=&#39;lg&#39;),
                            width=9
                            ),
                        dbc.Col(
                            dbc.Button(children=&#39;Apply&#39;,
                                       id=&#39;color-picker-btn&#39;,
                                       color=&#39;primary&#39;,
                                       class_name=&#39;button-fullsize&#39;),
                            width=3
                        )
                    ],
                            align=&#39;center&#39;)],
                        width={&#39;size&#39;: 6, &#39;offset&#39;: 3},
                        style={&#39;text-align&#39;: &#39;center&#39;})
            ),
            html.Br(),
            dbc.Row(
                dbc.Col([
                    dbc.Label(&#34;Download Blueprint&#34;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                    html.Br(),                   
                    dbc.Button(&#39;Download&#39;,
                               id=&#39;download-btn&#39;,
                               disabled=False),
                    dcc.Download(id=&#39;download-content&#39;),
                    html.Br(),
                    html.Br(),
                    dcc.Loading(id=&#39;download-spinner&#39;,
                                children=&#39;\n\n&#39;,
                                fullscreen=False,
                                color=&#39;#eeeeee&#39;,
                                type=&#39;default&#39;,
                                style={&#39;justify-content&#39;: &#39;center&#39;})
                    ],
                        width={&#39;size&#39;: 6, &#39;offset&#39;: 3},
                        style={&#39;text-align&#39;: &#39;center&#39;, &#39;justify-content&#39;: &#39;center&#39;})
            )
        ]
    )
    
    spaceship_controls = html.Div(
        dbc.Row(
            children=[dbc.Col(children=[
                html.Div(children=[
                    html.H4(children=&#39;Spaceship Controls&#39;,
                            className=&#39;section-title&#39;),
                    dbc.Button(&#39;🛈&#39;,
                               color=&#39;info&#39;,
                               id=&#39;download-help&#39;,
                               className=&#39;help&#39;)
                ],
                         style={&#39;display&#39;: &#39;inline-flex&#39;, &#39;flex-direction&#39;: &#39;row&#39;, &#39;justify-content&#39;: &#39;center&#39;, &#39;text-align&#39;: &#39;center&#39;}
                ),
                    
                    html.Br(),
                    color_and_download
                    ],
                              style={&#39;text-align&#39;: &#39;center&#39;})
            ]))
    
    content_properties = html.Div(
        children=[
            dbc.Row(children=[
                dbc.Col(children=[
                    dbc.Table(children=get_properties_table(),
                              id=&#39;spaceship-properties&#39;,
                              bordered=True,
                              color=&#39;dark&#39;,
                              hover=True,
                              size=&#39;sm&#39;,
                              responsive=True,
                              striped=True),
                    # TODO move Content String above High-level Rules (on the same row, so pushing it down)
                    html.Div([
                        html.P(children=&#39;Content String: &#39;),
                        dbc.Textarea(id=&#39;content-string&#39;,
                                    value=&#39;&#39;,
                                    contentEditable=False,
                                    disabled=True,
                                    class_name=&#39;content-string-area&#39;)
                        ],
                            style={} if app_settings.app_mode == AppMode.DEV else hidden_style)
                    ],
                        style={
                            &#39;max-height&#39;: &#39;30vh&#39;,
                            &#39;overflow&#39;: &#39;auto&#39;
                            })],
                    align=&#39;center&#39;)])    
   
    log = html.Div(
        children=[
            html.H4(children=&#39;Log&#39;,
                    className=&#39;section-title&#39;),
            html.Br(),
            dbc.Textarea(id=&#39;console-out&#39;,
                         value=&#39;&#39;,
                         wrap=False,
                         contentEditable=False,
                         disabled=True,
                         className=&#39;log-area&#39;),
            ])
    
    properties_panel = html.Div(
        children=[
            dbc.Row(
                dbc.Col([
                    html.H4(&#39;Spaceship Properties&#39;,
                            className=&#39;section-title&#39;),
                    html.Br()
                    ])),
            dbc.Row(
                      [
                          dbc.Col(content_properties)
                      ]
                  ),
            ]
    )
    
    experiment_settings = html.Div(
        children=[
            html.H4(children=&#39;Experiment Settings&#39;,
                    className=&#39;section-title&#39;),
            html.Br(),
            html.Div(children=[
                html.P(children=f&#39;Selected bin(s): {app_settings.selected_bins}&#39;,
                       id=&#39;selected-bin&#39;)
                ]),
            html.Br(),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Feature Descriptors (X, Y):&#39;),
                dbc.DropdownMenu(label=app_settings.current_mapelites.b_descs[0].name,
                             children=[
                                 dbc.DropdownMenuItem(b.name, id=f&#34;bc0-{b.name.replace(&#39; / &#39;, &#39;_&#39;).replace(&#39; &#39;, &#39;-&#39;)}&#34;)
                                 for b in app_settings.behavior_descriptors],
                             id=&#39;b0-dropdown&#39;),
                dbc.DropdownMenu(label=app_settings.current_mapelites.b_descs[1].name,
                             children=[
                                 dbc.DropdownMenuItem(b.name, id=f&#34;bc1-{b.name.replace(&#39; / &#39;, &#39;_&#39;).replace(&#39; &#39;, &#39;-&#39;)}&#34;)
                                 for b in app_settings.behavior_descriptors],
                             id=&#39;b1-dropdown&#39;)
                ],
                           className=&#34;mb-3&#34;,
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Toggle L-system Modules:&#39;),
                dbc.Checklist(id=&#39;lsystem-modules&#39;,
                              options=[{&#39;label&#39;: x.name, &#39;value&#39;: x.name} for x in app_settings.current_mapelites.lsystem.modules],
                              value=[x.name for x in app_settings.current_mapelites.lsystem.modules if x.active],
                              inline=True,
                              switch=True)
                ],
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style,
                           className=&#34;mb-3&#34;),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Fitness Weights:&#39;),
                html.Div(children=[
                    html.Div(children=[
                        dbc.Label(children=f.name,
                                  style={&#39;font-size&#39;: &#39;large&#39;}),
                        html.Div(children=[
                            dcc.Slider(min=0,
                                       max=1,
                                       step=0.1,
                                       value=1,
                                       marks=None,
                                       tooltip={&#34;placement&#34;: &#34;bottom&#34;,
                                                &#34;always_visible&#34;: False},
                                       id={&#39;type&#39;: &#39;fitness-sldr&#39;,
                                           &#39;index&#39;: i})
                        ],
                                 )
                        ]) for i, f in enumerate(app_settings.current_mapelites.feasible_fitnesses)
                    ])
                ],
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style,
                           className=&#34;mb-3&#34;),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Select Emitter:&#39;),
                dbc.DropdownMenu(label=&#39;Random&#39;,
                                 children=[
                                     dbc.DropdownMenuItem(&#39;Human&#39;, id=&#39;emitter-human&#39;),
                                     dbc.DropdownMenuItem(&#39;Random&#39;, id=&#39;emitter-random&#39;),
                                     dbc.DropdownMenuItem(&#39;Greedy&#39;, id=&#39;emitter-greedy&#39;),
                                     dbc.DropdownMenuItem(&#39;Preference Matrix&#39;, id=&#39;emitter-prefmatrix&#39;),
                                     dbc.DropdownMenuItem(&#39;Preference Bandit&#39;, id=&#39;emitter-prefbandit&#39;),
                                     dbc.DropdownMenuItem(&#39;Contextual Bandit&#39;, id=&#39;emitter-conbandit&#39;),
                                     dbc.DropdownMenuItem(&#39;KNN&#39;, id=&#39;emitter-knn&#39;),
                                     dbc.DropdownMenuItem(&#39;Linear Kernel&#39;, id=&#39;emitter-linkernel&#39;),
                                     dbc.DropdownMenuItem(&#39;RBF Kernel&#39;, id=&#39;emitter-rbfkernel&#39;)
                                     ],
                                 id=&#39;emitter-dropdown&#39;)
                ],
                           className=&#34;mb-3&#34;,
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Enforce Symmetry:&#39;),
                dbc.DropdownMenu(label=&#39;None&#39;,
                             children=[
                                 dbc.DropdownMenuItem(&#39;None&#39;, id=&#39;symmetry-none&#39;),
                                 dbc.DropdownMenuItem(&#39;X-axis&#39;, id=&#39;symmetry-x&#39;),
                                 dbc.DropdownMenuItem(&#39;Y-axis&#39;, id=&#39;symmetry-y&#39;),
                                 dbc.DropdownMenuItem(&#39;Z-axis&#39;, id=&#39;symmetry-z&#39;),
                             ],
                             id=&#39;symmetry-dropdown&#39;,
                             style={} if app_settings.app_mode == AppMode.DEV else hidden_style),
                dbc.RadioItems(id=&#39;symmetry-radio&#39;,
                        options=[
                            {&#39;label&#39;: &#39;Upper&#39;, &#39;value&#39;: &#39;Upper&#39;},
                            {&#39;label&#39;: &#39;Lower&#39;, &#39;value&#39;: &#39;Lower&#39;}
                        ],
                        value=&#39;Upper&#39;)
                ],
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style,
                           className=&#34;mb-3&#34;),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Save/Load Population:&#39;),
                dbc.Button(id=&#39;popdownload-btn&#39;,
                           children=&#39;Download Current Population&#39;),
                dcc.Upload(
                    id=&#39;popupload-data&#39;,
                    children=&#39;Upload Population&#39;,
                    className=&#39;upload&#39;,
                    multiple=False
                    ),
                ],
                           className=&#34;mb-3&#34;,
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style)
            ],
        style={} if app_settings.app_mode == AppMode.DEV else hidden_style)
    
    experiment_controls = html.Div(
        children=[
            html.H4(&#39;Population Controls&#39;,
                    className=&#39;section-title&#39;),
            dbc.Row(children=[
                html.Br(),
                dbc.Col(children=[
                    dbc.Button(id=&#39;step-btn&#39;,
                               children=&#39;Evolve From Selected Spaceship&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        id=&#39;step-btn-div&#39;,
                        width=6),
                dbc.Col(children=[
                    dbc.Button(id=&#39;rand-step-btn&#39;,
                               children=&#39;Evolve From Random Spaceship&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        id=&#39;rand-step-btn-div&#39;,
                        style={} if app_settings.app_mode == AppMode.USER else hidden_style,
                        width=6)
                ],
                    style={&#39;justify-content&#39;: &#39;center&#39;, &#39;flex-wrap&#39;: &#39;inherit&#39;}),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;selection-clr-btn&#39;,
                               children=&#39;Clear Selection&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        width=6)],
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.DEV else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style}),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;selection-btn&#39;,
                               children=&#39;Toggle Single Bin Selection&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        width=6)],
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.DEV else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style}),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;reset-btn&#39;,
                               children=&#39;Reinitialize Population&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        id=&#39;reset-btn-div&#39;,
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.USER else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style},
                        width={&#39;offset&#39;: 3, &#39;size&#39;: 6})]),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;subdivide-btn&#39;,
                               children=&#39;Subdivide Selected Bin(s)&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        width=6)],
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.DEV else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style}),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;download-mapelites-btn&#39;,
                               children=&#39;Download MAP-Elites&#39;,
                               className=&#39;button-fullsize&#39;),
                    dcc.Download(id=&#39;download-mapelites&#39;)
                    ],
                        width=6)],
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.DEV else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style}),
        ])
    
    rules = html.Div(
        children=[
            html.H4(children=&#39;High-level Rules&#39;,
                    className=&#39;section-title&#39;),
            html.Br(),
            dbc.Textarea(id=&#39;hl-rules&#39;,
                         value=str(app_settings.current_mapelites.lsystem.hl_solver.parser.rules),
                         wrap=False,
                         className=&#39;rules-area&#39;),
            dbc.Row(
                dbc.Col(dbc.Button(children=&#39;Update High-level Rules&#39;,
                                   id=&#39;update-rules-btn&#39;),
                        width={&#39;size&#39;: 4, &#39;offset&#39;:4}),
                align=&#39;center&#39;)
            ],
        style={} if app_settings.app_mode == AppMode.DEV else hidden_style)
    
    progress = html.Div(
        children=[
            dbc.Row(
                dbc.Col(children=[
                    dbc.Label(&#39;Evolution Progress&#39;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                    dbc.Progress(id=&#34;step-progress&#34;,
                                 color=&#39;info&#39;,
                                 striped=True,
                                 animated=True)
                ],
                        align=&#39;center&#39;,
                        style={&#39;text-align&#39;: &#39;center&#39;})
            )
        ],
        id=&#39;step-progress-div&#39;,
        style={&#39;content-visibility&#39;: &#39;visible&#39; if 0 &lt;= app_settings.step_progress &lt;= 100 else &#39;hidden&#39;,
               &#39;display&#39;: &#39;inline-block&#39; if 0 &lt;= app_settings.step_progress &lt;= 100 else &#39;none&#39;,
               &#39;width&#39;: &#39;100%&#39;})
    
    load_spinner = html.Div(children=[
        dbc.Row(
            dbc.Col(children=[
                dcc.Loading(id=&#39;step-spinner&#39;,
                            children=&#39;&#39;,
                            fullscreen=False,
                            color=&#39;#eeeeee&#39;,
                            type=&#39;circle&#39;)
            ],
                )
        )
        
    ])
    
    intervals = html.Div(
        children=[
            dcc.Interval(id=&#39;interval1&#39;,
                         interval=1 * 1000,
                         n_intervals=0),
            dcc.Interval(id=&#39;interval2&#39;,
                         interval=1 * 10,
                         n_intervals=0)
        ]
    )
    
    return dbc.Container(
        children=[
            modals,
            header,
            dbc.Row(children=[
                dbc.Row(children=[
                    quit_user_study_div
                ]),
                dbc.Row(children=[
                    dbc.Col(children=[
                        exp_progress,
                        progress
                        ],
                            width={&#39;offset&#39;: 4, &#39;size&#39;: 4}
                    ),
                    dbc.Col(children=[
                        load_spinner
                    ],
                            align=&#39;center&#39;,
                            width=3)
                ])
            ]),
            html.Br(),
            html.Br(),
            dbc.Row(children=[
                dbc.Col(mapelites_heatmap, width={&#39;size&#39;: 3, &#39;offset&#39;: 1}, style={&#39;overflow&#39;: &#39;auto&#39;}),
                dbc.Col(content_plot, width=4, style={&#39;overflow&#39;: &#39;auto&#39;}),
                dbc.Col(properties_panel, width=3)],
                    align=&#34;start&#34;, style={&#39;overflow&#39;: &#39;auto&#39;}),
            html.Br(),
            html.Br(),
            dbc.Row(children=[
                dbc.Col(children=[mapelites_controls,
                                  experiment_controls],
                        width={&#39;size&#39;: 3, &#39;offset&#39;: 1}),
                dbc.Col(children=[
                    spaceship_controls,
                    experiment_settings],
                        width=4),
                dbc.Col(children=[log,
                                  rules,
                                  intervals
                                  ],
                        width=3)],
                    align=&#34;start&#34;),
            
            dcc.Download(id=&#39;download-population&#39;),
            dcc.Download(id=&#39;download-metrics&#39;),
            
            html.Div(id=&#39;hidden-div&#39;,
                     children=[],
                     style=hidden_style)
            ],
        fluid=True)


loading_data_component = html.Div(children=[
    dbc.Row(children=[
        dbc.Col(children=[
            dbc.Label(&#34;Loading necessary data, this may take a while...     &#34;,
                      size=&#39;sm&#39;),
            dbc.Spinner(color=&#34;success&#34;,
                        type=&#34;border&#34;,
                        size=&#39;sm&#39;)
        ],
                align=&#39;center&#39;,
                style={&#39;justify-content&#39;: &#39;center&#39;, &#39;text-align&#39;: &#39;center&#39;}),
    ])
]
)


# clientside callback to open the Google Forms questionnaire on a new page
app.clientside_callback(
    &#34;&#34;&#34;
    function(clicks) {
        if (clicks) {
            window.open(&#34;https://forms.gle/gsuajDXUNocZvDzn9&#34;, &#34;_blank&#34;);
            return 0;
        }
    }
    &#34;&#34;&#34;,
    Output(&#34;hidden-div&#34;, &#34;n_clicks&#34;),  # super hacky but Dash leaves me no choice
    Input(&#34;consent-yes&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)


# clientside callback to autoscroll log textarea
app.clientside_callback(
    &#34;&#34;&#34;
    function checkTextareaHeight() {
        var textarea = document.getElementById(&#34;console-out&#34;);
        if(textarea.selectionStart == textarea.selectionEnd) {
            textarea.scrollTop = textarea.scrollHeight;
        }
        return &#34;&#34;;
    }
    &#34;&#34;&#34;,
    Output(&#34;hidden-div&#34;, &#34;title&#34;),  # super hacky but Dash leaves me no choice
    Input(&#34;interval1&#34;, &#34;n_intervals&#34;),
    prevent_initial_call=True
)


@app.callback(
    Output(&#34;webapp-info-modal&#34;, &#34;is_open&#34;),
    Input(&#34;webapp-info-btn&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_webapp_info(n):
    return True


@app.callback(
    Output(&#34;algo-info-modal&#34;, &#34;is_open&#34;),
    Input(&#34;ai-info-btn&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_algo_info(n):
    return True


@app.callback(
    Output(&#34;hh-modal&#34;, &#34;is_open&#34;),
    Input(&#34;heatmap-help&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_heatmap_help(n):
    return True


@app.callback(
    Output(&#34;ch-modal&#34;, &#34;is_open&#34;),
    Input(&#34;content-help&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_content_help(n):
    return True

@app.callback(
    Output(&#34;dh-modal&#34;, &#34;is_open&#34;),
    Input(&#34;download-help&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_download_help(n):
    return True


@app.callback(Output(&#39;console-out&#39;, &#39;value&#39;),
              Input(&#39;interval1&#39;, &#39;n_intervals&#39;),
              prevent_initial_call=True)
def update_output(n):
    return (&#39;\n&#39;.join(dashLoggerHandler.queue))


@app.callback(
    [Output(&#34;step-progress&#34;, &#34;value&#34;),
     Output(&#34;step-progress&#34;, &#34;label&#34;),
     Output(&#39;step-progress-div&#39;, &#39;style&#39;)],
    [Input(&#34;interval1&#34;, &#34;n_intervals&#34;)],
    prevent_initial_call=True
)
def update_progress(n):  
    return app_settings.step_progress, f&#34;{np.round(app_settings.step_progress, 2)}%&#34;, {&#39;content-visibility&#39;: &#39;visible&#39; if 0 &lt;= app_settings.step_progress &lt;= 100 else &#39;hidden&#39;,
                                                                                       &#39;display&#39;: &#39;inline-block&#39; if 0 &lt;= app_settings.step_progress &lt;= 100 else &#39;none&#39;,
                                                                                       &#39;width&#39;: &#39;100%&#39;}


@app.callback(
    [Output(&#34;gen-progress&#34;, &#34;value&#34;),
     Output(&#34;gen-progress&#34;, &#34;label&#34;)],
    [Input(&#34;interval1&#34;, &#34;n_intervals&#34;)],
    prevent_initial_call=True
)
def update_gen_progress(n):
    if app_settings.app_mode != AppMode.DEV:
        val = np.round(100 * ((app_settings.gen_counter) / N_GENS_ALLOWED), 2)
        return val, f&#34;{app_settings.gen_counter} / {N_GENS_ALLOWED}&#34;
    else:
        return 100, f&#34;{app_settings.gen_counter}&#34;


@app.callback(
    [Output(&#34;exp-progress&#34;, &#34;value&#34;),
     Output(&#34;exp-progress&#34;, &#34;label&#34;)],
    [Input(&#34;interval1&#34;, &#34;n_intervals&#34;)],
    prevent_initial_call=True
)
def update_exp_progress(n):
    val = min(100, np.round(100 * ((1 + app_settings.exp_n) / len(app_settings.my_emitterslist)), 2))
    return val, f&#34;{min(app_settings.exp_n + 1, len(app_settings.my_emitterslist))} / {len(app_settings.my_emitterslist)}&#34;


@app.callback(
    Output(&#34;download-mapelites&#34;, &#34;data&#34;),
    Input(&#34;download-mapelites-btn&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True,
)
def download_mapelites(n_clicks):    
    t = datetime.now().strftime(&#34;%Y%m%d%H%M%S&#34;)
    fname = f&#39;{t}_mapelites_{app_settings.current_mapelites.emitter.name}_gen{app_settings.gen_counter:02}&#39;
    logging.getLogger(&#39;webapp&#39;).info(f&#39;The MAP-Elites object will be downloaded shortly.&#39;)
    return dict(content=json_dumps(app_settings.current_mapelites), filename=f&#39;{fname}.json&#39;)


@app.callback(
    Output(&#34;download-content&#34;, &#34;data&#34;),
    Output(&#39;download-spinner&#39;, &#39;children&#39;),
    State(&#39;content-plot&#39;, &#39;figure&#39;),
    State(&#34;content-plot&#34;, &#34;relayoutData&#34;),
    Input(&#34;download-btn&#34;, &#34;n_clicks&#34;),
    # prevent_initial_call=True,
)
def download_content(curr_content, curr_camera,
                     n):
    global base_color
    global download_semaphore
    
        
    def write_archive(bytes_io):
        with ZipFile(bytes_io, mode=&#34;w&#34;) as zf:
            # with open(&#39;./assets/thumb.png&#39;, &#39;rb&#39;) as f:
            #     thumbnail_img = f.read()
            content_fig = go.Figure(data=curr_content[&#39;data&#39;],
                                     layout=curr_content[&#39;layout&#39;])
            content_fig.update_layout(scene_camera=curr_camera)
            thumbnail_img = content_fig.to_image(format=&#34;png&#34;)
            zf.writestr(&#39;thumb.png&#39;, thumbnail_img)
            elite = get_elite(mapelites=app_settings.current_mapelites,
                              bin_idx=_switch([app_settings.selected_bins[-1]])[0],
                              pop=&#39;feasible&#39;)
            tmp = CandidateSolution(string=elite.string)
            tmp.ll_string = elite.ll_string
            tmp.base_color = elite.base_color
            app_settings.current_mapelites.lsystem._set_structure(cs=tmp)
            hullbuilder = HullBuilder(erosion_type=app_settings.current_mapelites.hull_builder.erosion_type,
                                      apply_erosion=True,
                                      apply_smoothing=True)
            download_semaphore.unlock()
            download_semaphore._running = &#39;YES&#39;           
            logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.write_archive] {download_semaphore.is_locked=}&#39;)
            hullbuilder.add_external_hull(tmp.content)
            tmp.content.set_color(tmp.base_color)
            logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.write_archive] {tmp.string=}; {tmp.content=}; {tmp.base_color=}&#39;)
            zf.writestr(&#39;bp.sbc&#39;, convert_structure_to_xml(structure=tmp.content, name=f&#39;My Spaceship ({app_settings.rngseed}) (exp{app_settings.exp_n})&#39;))
            content_properties = {
                &#39;string&#39;: tmp.string,
                &#39;base_color&#39;: tmp.base_color.as_dict()
            }
            zf.writestr(f&#39;spaceship_{app_settings.rngseed}_exp{app_settings.exp_n}&#39;, json.dumps(content_properties))
            download_semaphore._running = &#39;NO&#39;
    
    if app_settings.selected_bins:
        logging.getLogger(&#39;webapp&#39;).info(f&#39;Your selected spaceship will be downloaded shortly.&#39;)
        return dcc.send_bytes(write_archive, f&#39;MySpaceship_{app_settings.rngseed}_exp{app_settings.exp_n}_gen{app_settings.gen_counter}.zip&#39;), &#39;\n\n&#39;
    else:
        return None, &#39;\n\n&#39;

@app.callback(
    Output(&#34;consent-yes&#34;, &#34;disabled&#34;),
    Output(&#34;consent-no&#34;, &#34;disabled&#34;),
    Input(&#34;consent-yes&#34;, &#34;n_clicks&#34;),
    Input(&#34;consent-no&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def disable_privacy_modal(ny, nn):
    return True, True


@app.callback(Output(&#39;step-btn&#39;, &#39;disabled&#39;),
              Output(&#39;download-btn&#39;, &#39;disabled&#39;),
              Output(&#39;popdownload-btn&#39;, &#39;disabled&#39;),
              Output(&#39;rand-step-btn&#39;, &#39;disabled&#39;),
              Output(&#39;selection-clr-btn&#39;, &#39;disabled&#39;),
              Output(&#39;selection-btn&#39;, &#39;disabled&#39;),
              Output(&#39;reset-btn&#39;, &#39;disabled&#39;),
              Output(&#39;subdivide-btn&#39;, &#39;disabled&#39;),
              Output(&#39;download-mapelites-btn&#39;, &#39;disabled&#39;),
              Output(&#39;update-rules-btn&#39;, &#39;disabled&#39;),
              Output(&#39;popupload-data&#39;, &#39;disabled&#39;),
              Output(&#39;population-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;metric-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;method-radio&#39;, &#39;options&#39;),
              Output(&#39;b0-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;b1-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;lsystem-modules&#39;, &#39;options&#39;),
              Output(&#39;emitter-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;symmetry-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;symmetry-radio&#39;, &#39;options&#39;),
              Output(&#39;color-picker&#39;, &#39;disabled&#39;),
              Output(&#39;heatmap-plot-container&#39;, &#39;style&#39;),
              Output({&#39;type&#39;: &#39;fitness-sldr&#39;, &#39;index&#39;: ALL}, &#39;disabled&#39;),
              Output(&#39;qus-btn&#39;, &#39;disabled&#39;),
              Output(&#39;webapp-quickstart-btn&#39;, &#39;disabled&#39;),
              Output(&#39;webapp-info-btn&#39;, &#39;disabled&#39;),
              Output(&#39;ai-info-btn&#39;, &#39;disabled&#39;),
              Output(&#39;qus-y-btn&#39;, &#39;disabled&#39;),
              Output(&#39;consent-body-loading&#39;, &#39;children&#39;),
              Output(&#39;eous-body-loading&#39;, &#39;children&#39;),
              Output(&#39;eus-body-loading&#39;, &#39;children&#39;),
              Output(&#39;color-picker-btn&#39;, &#39;disabled&#39;),

              State({&#39;type&#39;: &#39;fitness-sldr&#39;, &#39;index&#39;: ALL}, &#39;disabled&#39;),
              State(&#39;method-radio&#39;, &#39;options&#39;),
              State(&#39;lsystem-modules&#39;, &#39;options&#39;),
              State(&#39;symmetry-radio&#39;, &#39;options&#39;),
              State(&#39;consent-body-loading&#39;, &#39;children&#39;),
              State(&#39;eous-body-loading&#39;, &#39;children&#39;),
              State(&#39;eus-body-loading&#39;, &#39;children&#39;),
                   
              Input(&#39;interval2&#39;, &#39;n_intervals&#39;),
              )
def interval_updates(fdis, ms, lsysms, symms, consent_loading_data_children, eous_loading_data_children, eus_loading_data_children,
                      ni):
    # non-definitive solution, see: https://github.com/plotly/dash-table/issues/925, https://github.com/plotly/dash/issues/1861
    # long_callback and background callback also do not work (infinite redeployment of webapp)
    global process_semaphore
    
    running_something = process_semaphore.is_locked
    
    for o in ms:
        o[&#39;disabled&#39;] = running_something
    for o in symms:
        o[&#39;disabled&#39;] = running_something
    for o in lsysms:
        o[&#39;disabled&#39;] = running_something
    
    btns = {
        &#39;step-btn.disabled&#39;: running_something or (app_settings.app_mode == AppMode.USERSTUDY and app_settings.gen_counter &gt;= N_GENS_ALLOWED),
        &#39;download-btn.disabled&#39;: running_something or download_semaphore._running == &#39;YES&#39;,
        &#39;popdownload-btn.disabled&#39;: running_something,
        &#39;rand-step-btn.disabled&#39;: running_something,
        &#39;selection-clr-btn.disabled&#39;: running_something,
        &#39;selection-btn.disabled&#39;: running_something,
        &#39;reset-btn.disabled&#39;: running_something,
        &#39;subdivide-btn.disabled&#39;: running_something,
        &#39;download-mapelites-btn.disabled&#39;: running_something,
        &#39;update-rules-btn.disabled&#39;: running_something,
        &#39;popupload-data.disabled&#39;: running_something,
        &#39;population-dropdown.disabled&#39;: running_something,
        &#39;metric-dropdown.disabled&#39;: running_something,
        &#39;method-radio.options&#39;: ms,
        &#39;b0-dropdown.disabled&#39;: running_something,
        &#39;b1-dropdown.disabled&#39;: running_something,
        &#39;lsystem-modules.options&#39;: lsysms,
        &#39;emitter-dropdown.disabled&#39;: running_something,
        &#39;symmetry-dropdown.disabled&#39;: running_something,
        &#39;symmetry-radio.options&#39;: symms,
        &#39;color-picker.disabled&#39;: running_something,
        &#39;heatmap-plot-container.style&#39;: {&#39;visibility&#39;: &#39;visible&#39; if running_something else &#39;hidden&#39;,
                                         &#39;display&#39;: &#39;grid&#39; if running_something else &#39;none&#39;,
                                        #  &#39;background&#39;: &#39;#ffffff11&#39;,  # decomment for debugging purposes
                                         &#39;pointer-events&#39;: &#39;auto&#39;,
                                         &#39;z-index&#39;: 1 if running_something else -1},
        &#39;fitness-sldr.disabled&#39;: [running_something] * len(fdis),
        &#39;qus-btn.disabled&#39;: running_something,
        &#39;webapp-quickstart-btn.disabled&#39;: running_something,
        &#39;webapp-info-btn.disabled&#39;: running_something,
        &#39;ai-info-btn.disabled&#39;: running_something,
        &#39;qus-y-btn.disabled&#39;: running_something,
        &#39;consent-body-loading.children&#39;: [],
        &#39;eous-body-loading.children&#39;: [],
        &#39;eus-body-loading.children&#39;: [],
        &#39;color-picker-btn.disabled&#39;: running_something,
    }
    
    if running_something and consent_loading_data_children == []:
        btns[&#39;consent-body-loading.children&#39;] = loading_data_component
    elif running_something and consent_loading_data_children != []:
        btns[&#39;consent-body-loading.children&#39;] = dash.no_update
    
    if running_something and eous_loading_data_children == []:
        btns[&#39;eous-body-loading.children&#39;] = loading_data_component
    elif running_something and eous_loading_data_children != []:
        btns[&#39;eous-body-loading.children&#39;] = dash.no_update
    
    if running_something and eus_loading_data_children == []:
        btns[&#39;eus-body-loading.children&#39;] = loading_data_component
    elif running_something and eus_loading_data_children != []:
        btns[&#39;eus-body-loading.children&#39;] = dash.no_update
    
    return tuple(btns.values())


def _switch(ls: List[Tuple[int, int]]) -&gt; List[Tuple[int, int]]:
    return [(e[1], e[0]) for e in ls]


def _format_bins(mapelites: MAPElites,
                 bins_idx_list: List[Tuple[int, int]],
                 str_prefix: str,
                 do_switch: bool = True,
                 filter_out_empty: bool = True) -&gt; Tuple[List[Tuple[int, int]], str]:
    bins_list: List[MAPBin] = [mapelites.bins[j, i] if do_switch else mapelites.bins[i, j] for (i, j) in bins_idx_list]
    sel_bins_str = f&#39;{str_prefix}&#39;
    for b in bins_list:
        i, j = b.bin_idx
        if filter_out_empty:
            if b.non_empty(pop=&#39;feasible&#39;) or b.non_empty(pop=&#39;infeasible&#39;):
                i, j = (j, i) if do_switch else (i, j)
                bc1 = np.sum([mbin.bin_size[0] for mbin in mapelites.bins[:i, j]])
                bc2 = np.sum([mbin.bin_size[1] for mbin in mapelites.bins[i, :j]])
                sel_bins_str += f&#39; {(i, j)} [{bc1}:{bc2}];&#39;
            elif b.bin_idx in bins_idx_list:
                bins_idx_list.remove((i, j))
        else:
            bc1 = np.sum([mbin.bin_size[0] for mbin in mapelites.bins[:i, j]])
            bc2 = np.sum([mbin.bin_size[1] for mbin in mapelites.bins[i, :j]])
            sel_bins_str += f&#39; {(i, j)} [{bc1}:{bc2}];&#39;
    return bins_idx_list, sel_bins_str


def _build_heatmap(mapelites: MAPElites,
                   pop_name: str,
                   metric_name: str,
                   method_name: str) -&gt; go.Figure:    
    valid_bins = [x.bin_idx for x in mapelites._valid_bins()]
    metric = app_settings.hm_callback_props[&#39;metric&#39;][metric_name]
    use_mean = app_settings.hm_callback_props[&#39;method&#39;][method_name]
    population = app_settings.hm_callback_props[&#39;pop&#39;][pop_name]
    # build heatmap
    disp_map = np.zeros(shape=mapelites.bins.shape)
    labels = np.zeros(shape=(mapelites.bins.shape[1], mapelites.bins.shape[0], 2))
    text = []
    x_labels = np.round(np.cumsum([0] + mapelites.bin_sizes[0][:-1]) + mapelites.b_descs[0].bounds[0], 2)
    y_labels = np.round(np.cumsum([0] + mapelites.bin_sizes[1][:-1]) + mapelites.b_descs[1].bounds[0], 2)
    for i in range(mapelites.bins.shape[0]):
        for j in range(mapelites.bins.shape[1]):
            v = mapelites.bins[i, j].get_metric(metric=metric[&#39;name&#39;],
                                                use_mean=use_mean,
                                                population=population)
            disp_map[i, j] = v if v != 0 else None
            s = &#39;&#39;
            if mapelites.bins[i, j].non_empty(pop=&#39;feasible&#39;):
                if (i, j) in valid_bins:
                    if (j, i) in app_settings.selected_bins:
                        s = &#39;☑&#39;
                    elif app_settings.gen_counter &gt; 0 and mapelites.bins[i, j].new_elite[population]:
                        s = &#39;▣&#39;                
            if j == 0:
                text.append([s])
            else:
                text[-1].append(s)
            labels[j, i, 0] = x_labels[i]
            labels[j, i, 1] = y_labels[j]
    # plot
    hovertemplate = f&#39;{mapelites.b_descs[0].name}: X&lt;br&gt;{mapelites.b_descs[1].name}: Y&lt;br&gt;{metric_name}: Z&lt;extra&gt;&lt;/extra&gt;&#39;
    hovertemplate = hovertemplate.replace(&#39;X&#39;, &#39;%{customdata[0]}&#39;).replace(&#39;Y&#39;, &#39;%{customdata[1]}&#39;).replace(&#39;Z&#39;, &#39;%{z}&#39;)
    heatmap = go.Figure(
        data=go.Heatmap(
            z=disp_map,
            zmin=0,
            zmax=app_settings.hm_callback_props[&#39;metric&#39;][metric_name][&#39;zmax&#39;][population],
            x=np.arange(disp_map.shape[0]),
            y=np.arange(disp_map.shape[1]),
            hoverongaps=False,
            colorscale=app_settings.hm_callback_props[&#39;metric&#39;][metric_name][&#39;colorscale&#39;],
            text=text,
            texttemplate=&#39;%{text}&#39;,
            textfont={&#34;color&#34;: &#39;rgba(238, 238, 238, 1.)&#39;},
            colorbar={&#34;title&#34;: {&#34;text&#34;: &#34;Fitness&#34;, &#34;side&#34;: &#34;right&#34;}, &#39;orientation&#39;: &#39;v&#39;},
            customdata=labels,
            ))
    heatmap.update_xaxes(title=dict(text=mapelites.b_descs[0].name))
    heatmap.update_yaxes(title=dict(text=mapelites.b_descs[1].name))
    heatmap.update_coloraxes(colorbar_title_text=metric_name)
    heatmap.update_layout(autosize=False,
                          dragmode=&#39;pan&#39;,
                          clickmode=&#39;event+select&#39;,
                          paper_bgcolor=&#39;rgba(0,0,0,0)&#39;,
                          plot_bgcolor=&#39;rgba(0,0,0,1)&#39;,
                          template=&#39;plotly_dark&#39;,
                          xaxis_showgrid=False,
                          yaxis_showgrid=False,
                          xaxis_zeroline=False,
                          yaxis_zeroline=False,
                          margin=go.layout.Margin(
                              l=0,
                              r=0,
                              b=0,
                              t=0))
    heatmap.update_traces(hovertemplate=hovertemplate)
    heatmap.update_traces(selector=dict(type=&#39;heatmap&#39;))
    heatmap.update_layout(
        xaxis={
            &#39;tickvals&#39;: np.arange(disp_map.shape[0]),
            &#39;ticktext&#39;: x_labels
        },
        yaxis={
            &#39;tickvals&#39;: np.arange(disp_map.shape[1]),
            &#39;ticktext&#39;: y_labels
        }
    )
    
    return heatmap


def _get_elite_content(mapelites: MAPElites,
                       bin_idx: Optional[Tuple[int, int]],
                       pop: str,
                       camera: Optional[Dict[str, Any]] = None,
                       show_voxel: bool = True) -&gt; go.Scatter3d:
    if bin_idx is not None:
        # get elite content
        elite = get_elite(mapelites=mapelites,
                          bin_idx=bin_idx,
                          pop=pop)
        structure = elite.content
        content = structure.as_grid_array
        arr = np.nonzero(content)
        x, y, z = arr
        fig = go.Figure()
        
        cs = [content[i, j, k] for i, j, k in zip(x, y, z)]
        unique_blocks = {v: structure._clean_label(list(block_definitions.keys())[v - 1]) for v in cs}
        
        if not show_voxel:
            ss = [structure._clean_label(list(block_definitions.keys())[v - 1]) for v in cs]
            custom_colors = []
            for (i, j, k) in zip(x, y, z):
                b = structure._blocks[(i * structure.grid_size, j * structure.grid_size, k * structure.grid_size)]
                if _is_base_block(block_type=structure._clean_label(b.block_type)):
                    custom_colors.append(f&#39;rgb{b.color.as_tuple()}&#39;)
                else:
                    custom_colors.append(block_to_colour.get(structure._clean_label(b.block_type), block_to_colour[&#39;Unrecognized&#39;]))
            # black points for internal air blocks
            air = np.nonzero(structure.air_blocks_gridmask)
            air_x, air_y, air_z = air
            x = np.asarray(x.tolist() + air_x.tolist())
            y = np.asarray(y.tolist() + air_y.tolist())
            z = np.asarray(z.tolist() + air_z.tolist())
            custom_colors.extend([block_to_colour[&#39;Air&#39;] for _ in range(len(air_x))])
            ss.extend([&#39;&#39; for _ in range(len(air_x))])
            # create scatter 3d plot
            fig.add_scatter3d(x=x,
                            y=y,
                            z=z,
                            mode=&#39;markers&#39;,
                            marker=dict(size=2,
                                        line=dict(width=4,
                                                    color=&#39;DarkSlateGrey&#39;),
                                        color=custom_colors),
                            opacity=1. if not show_voxel else 0.,
                            showlegend=False)
        
        else:
            transparent_blocks = np.zeros_like(content)
            opaque_blocks = np.zeros_like(content)
            for v, block_type in unique_blocks.items():
                if _is_transparent_block(block_type=block_type):
                    transparent_blocks[content == v] = v
                else:
                    opaque_blocks[content == v] = v
        
            # add voxel plot
            voxels = VoxelData(opaque_blocks)
            ss = [structure._clean_label(list(block_definitions.keys())[v - 1]) for v in voxels.intensities]
            indices = {structure._clean_label(n):i + 1 for i, n in enumerate(list(block_definitions.keys()))}
            custom_colors = {}
            for k, v in block_to_colour.items():
                if k in indices:
                    if _is_base_block(k):
                        custom_colors[indices[k]] = f&#39;rgb{base_color.as_tuple()}&#39;
                    else:
                        custom_colors[indices[k]] = v
            
            fig.add_mesh3d(x=voxels.vertices[0] - 0.5,
                        y=voxels.vertices[1] - 0.5,
                        z=voxels.vertices[2] - 0.5, 
                        i=voxels.triangles[0],
                        j=voxels.triangles[1],
                        k=voxels.triangles[2],
                        facecolor=[custom_colors[ix] for ix in voxels.intensities],
                        opacity=1.,
                        flatshading=True,
                        showlegend=False,
                        hoverinfo=&#39;text&#39;,
                        hovertext=ss
                        )
            
            fig.data[0].update(lighting=dict(ambient= 0.55,
                                            diffuse= 0.5,
                                            specular= 0.75,
                                            roughness=0.25,
                                            fresnel= 0.25))
            
            voxels = VoxelData(transparent_blocks)
            ss = [structure._clean_label(list(block_definitions.keys())[v - 1]) for v in voxels.intensities]
            indices = {structure._clean_label(n):i + 1 for i, n in enumerate(list(block_definitions.keys()))}
            custom_colors = {}
            for k, v in block_to_colour.items():
                if k in indices:
                    if _is_base_block(k):
                        custom_colors[indices[k]] = f&#39;rgb{base_color.as_tuple()}&#39;
                    else:
                        custom_colors[indices[k]] = v
            
            fig.add_mesh3d(x=voxels.vertices[0] - 0.5,
                        y=voxels.vertices[1] - 0.5,
                        z=voxels.vertices[2] - 0.5, 
                        i=voxels.triangles[0],
                        j=voxels.triangles[1],
                        k=voxels.triangles[2],
                        facecolor=[custom_colors[ix] for ix in voxels.intensities],
                        opacity=0.75,
                        flatshading=True,
                        showlegend=False,
                        hoverinfo=&#39;text&#39;,
                        hovertext=ss
                        )
            
            fig.data[1].update(lighting=dict(ambient= 0.55,
                                            diffuse= 0.5,
                                            specular= 0.75,
                                            roughness=0.25,
                                            fresnel= 0.25))
        
        # fig.update_traces()
        ux, uy, uz = np.unique(x), np.unique(y), np.unique(z)
        ptg = .2
        show_x = [v for i, v in enumerate(ux) if i % (1 / ptg) == 0]
        show_y = [v for i, v in enumerate(uy) if i % (1 / ptg) == 0]
        show_z = [v for i, v in enumerate(uz) if i % (1 / ptg) == 0]
        fig.update_layout(
            scene=dict(
                xaxis_title=&#39;&#39;,
                yaxis_title=&#39;m&#39;,
                zaxis_title=&#39;&#39;,
                xaxis={
                    &#39;tickvals&#39;: show_x,
                    &#39;ticktext&#39;: [structure.grid_size * i for i in show_x],
                },
                yaxis={
                    &#39;tickvals&#39;: show_y,
                    &#39;ticktext&#39;: [structure.grid_size * i for i in show_y],
                },
                zaxis={
                    &#39;tickvals&#39;: show_z,
                    &#39;ticktext&#39;: [structure.grid_size * i for i in show_z],
                }
            )
        )
    else:
        fig = go.Figure()
        fig.add_mesh3d(x=np.zeros(0, dtype=object),
                       y=np.zeros(0, dtype=object),
                       z=np.zeros(0, dtype=object))
    
    camera = camera if camera is not None else dict(up=dict(x=0, y=0, z=1),
                                                    center=dict(x=0, y=0, z=0),
                                                    eye=dict(x=2, y=2, z=2))
    fig.update_layout(scene=dict(aspectmode=&#39;data&#39;),
                      scene_camera=camera,
                      template=&#39;plotly_dark&#39;,
                    #   paper_bgcolor=&#39;rgba(0,0,0,0)&#39;,
                    #   plot_bgcolor=&#39;rgba(0,0,0,0)&#39;,
                      margin=go.layout.Margin(l=0,
                                              r=0,
                                              b=0,
                                              t=0))
    
    return fig


def _apply_step(mapelites: MAPElites,
                selected_bins: List[Tuple[int, int]],
                gen_counter: int,
                only_human: bool = False,
                only_emitter: bool = False) -&gt; bool:
    global app_settings
    global time_elapsed_user
    global time_elapsed_emitter
    
    perc_step = 100 / (1 + N_EMITTER_STEPS)
    
    valid = True
    if mapelites.enforce_qnt:
        valid_bins = [x.bin_idx for x in mapelites._valid_bins()]
        for bin_idx in selected_bins:
            valid &amp;= bin_idx in valid_bins
    if valid:
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Started step {gen_counter + 1}...&#39;)
        # reset bins new_elite flags
        mapelites.update_elites(reset=True)
        app_settings.step_progress = 0
        if not only_emitter:
            s = time.perf_counter()
            logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}._apply_step] human; {selected_bins=}&#39;)
            mapelites.interactive_step(bin_idxs=selected_bins,
                                       gen=gen_counter)
            elapsed_user = time.perf_counter() - s
            if app_settings.app_mode == AppMode.USERSTUDY:
                time_elapsed_user.add(elapsed_user)
        
        app_settings.step_progress += perc_step
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Completed step {gen_counter + 1} (created {mapelites.n_new_solutions} solutions); running {N_EMITTER_STEPS} additional emitter steps if available...&#39;)
        mapelites.n_new_solutions = 0
        all_elapsed_emitter = []
        with trange(N_EMITTER_STEPS, desc=&#39;Emitter steps: &#39;) as iterations:
            for _ in iterations:
                if not only_human:
                    s = time.perf_counter()
                    mapelites.emitter_step(gen=gen_counter)
                    all_elapsed_emitter.append(time.perf_counter() - s)
                app_settings.step_progress += perc_step
        if app_settings.app_mode == AppMode.USERSTUDY:
            time_elapsed_emitter.add(np.average(all_elapsed_emitter))
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter step(s) completed (created {mapelites.n_new_solutions} solutions).&#39;)
        mapelites.n_new_solutions = 0
        app_settings.step_progress = -1
        mapelites.update_elites()
        return True
    else:
        logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Step not applied: invalid bin(s) selected.&#39;)
        return False


def __apply_step(**kwargs) -&gt; Dict[str, Any]:
    global population_complexity
    global n_solutions_feas
    global n_solutions_infeas
    global app_settings
    
    cs_properties = kwargs[&#39;cs_properties&#39;]
    cs_string = kwargs[&#39;cs_string&#39;]
    curr_content = kwargs[&#39;curr_content&#39;]
    curr_heatmap = kwargs[&#39;curr_heatmap&#39;]
    eoe_modal_show = kwargs[&#39;eoe_modal_show&#39;]
    nbs_err_modal_show = kwargs[&#39;nbs_err_modal_show&#39;]
    dlbtn_label = kwargs[&#39;dlbtn_label&#39;]
    curr_camera = kwargs[&#39;curr_camera&#39;]   
    voxel_display = kwargs[&#39;curr_voxel_display&#39;]
    
    if app_settings.selected_bins or kwargs[&#39;event_trig&#39;] == &#39;rand-step-btn&#39;:
        s = time.perf_counter()
        res = _apply_step(mapelites=app_settings.current_mapelites,
                          selected_bins=_switch(app_settings.selected_bins),
                          gen_counter=app_settings.gen_counter,
                          only_human=kwargs[&#39;event_trig&#39;] == &#39;step-btn&#39; and app_settings.app_mode == AppMode.USER,
                          only_emitter=kwargs[&#39;event_trig&#39;] == &#39;rand-step-btn&#39; and app_settings.app_mode == AppMode.USER)
        if res:
            elapsed = time.perf_counter() - s
            new_complexity = app_settings.current_mapelites.population_complexity(pop=&#39;feasible&#39;)
            app_settings.gen_counter += 1
            # update metrics if user consented to privacy
            if app_settings.app_mode == AppMode.USERSTUDY:
                population_complexity.add(new_complexity)
                n_solutions_feas.add(float(app_settings.current_mapelites.total_solutions(&#39;feasible&#39;)))
                n_solutions_infeas.add(float(app_settings.current_mapelites.total_solutions(&#39;infeasible&#39;)))
            if app_settings.selected_bins:
                rem_idxs = []
                for i, b in enumerate(app_settings.selected_bins):
                    # remove preview and properties if last selected bin is now invalid
                    lb = _switch([b])[0]
                    if lb not in [b.bin_idx for b in app_settings.current_mapelites._valid_bins()]:
                        rem_idxs.append(i)
                for i in reversed(rem_idxs):
                    app_settings.selected_bins.pop(i)
                if app_settings.selected_bins == []:
                        curr_content = _get_elite_content(mapelites=app_settings.current_mapelites,
                                                          bin_idx=None,
                                                          pop=&#39;&#39;)
                        cs_string = &#39;&#39;
                        cs_properties = get_properties_table()
                else:
                    lb = _switch([app_settings.selected_bins[-1]])[0]
                    if app_settings.current_mapelites.bins[app_settings.selected_bins[-1]].new_elite[app_settings.hm_callback_props[&#39;pop&#39;][kwargs[&#39;pop_name&#39;]]]:
                        curr_content = _get_elite_content(mapelites=app_settings.current_mapelites,
                                                          bin_idx=lb,
                                                          pop=&#39;feasible&#39; if kwargs[&#39;pop_name&#39;] == &#39;Feasible&#39; else &#39;infeasible&#39;,
                                                          camera=curr_camera.get(&#39;scene.camera&#39;, None),
                                                          show_voxel=voxel_display)
                        elite = get_elite(mapelites=app_settings.current_mapelites,
                                          bin_idx=lb,
                                          pop=&#39;feasible&#39; if kwargs[&#39;pop_name&#39;] == &#39;Feasible&#39; else &#39;infeasible&#39;)
                        cs_string = elite.string
                        cs_properties = get_properties_table(cs=elite)
            # prompt user to download content if reached end of generations
            if app_settings.app_mode == AppMode.USERSTUDY and app_settings.gen_counter == N_GENS_ALLOWED:
                eoe_modal_show = True
            # update heatmap
            curr_heatmap = _build_heatmap(mapelites=app_settings.current_mapelites,
                                          pop_name=kwargs[&#39;pop_name&#39;],
                                          metric_name=kwargs[&#39;metric_name&#39;],
                                          method_name=kwargs[&#39;method_name&#39;])
            logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}.__apply_step] {elapsed=}; {new_complexity=}; {app_settings.gen_counter=}; {app_settings.selected_bins=}&#39;)
            
            
    else:
        logging.getLogger(&#39;webapp&#39;).error(msg=f&#39;Step not applied: no bin(s) selected.&#39;)
        nbs_err_modal_show = True
    
    if app_settings.app_mode == AppMode.USERSTUDY and app_settings.gen_counter == N_GENS_ALLOWED:
        if app_settings.exp_n + 1 == len(app_settings.my_emitterslist):
            dlbtn_label = &#39;Download and Switch to User Mode&#39;
        else:
            dlbtn_label = &#39;Download and Start Next Experiment&#39;
    
    return {
        &#39;content-plot.figure&#39;: curr_content,
        &#39;content-string.value&#39;: cs_string,
        &#39;eoe-modal.is_open&#39;: eoe_modal_show,
        &#39;heatmap-plot.figure&#39;: curr_heatmap,
        &#39;nbs-err-modal.is_open&#39;: nbs_err_modal_show,
        &#39;spaceship-properties.children&#39;: cs_properties,
        &#39;download-btn.children&#39;: dlbtn_label
    }


def __reset(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    global n_spaceships_inspected
    global time_elapsed_user
    global time_elapsed_emitter
    global population_complexity
    global n_solutions_feas
    global n_solutions_infeas
    
    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Started resetting all bins (this may take a while)...&#39;)
    app_settings.current_mapelites.reset()
    app_settings.current_mapelites.hull_builder.apply_smoothing = False
    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Reset completed.&#39;)
    app_settings.gen_counter = 0
    app_settings.selected_bins = []
    if app_settings.app_mode == AppMode.USERSTUDY:
        n_spaceships_inspected.reset()
        time_elapsed_user.reset()
        time_elapsed_emitter.reset()
        population_complexity.reset()
        n_solutions_feas.reset()
        n_solutions_infeas.reset()
    _update_base_color(color=base_color)
    
    return {
        &#39;heatmap-plot.figure&#39;: _build_heatmap(mapelites=app_settings.current_mapelites,
                                              pop_name=kwargs[&#39;pop_name&#39;],
                                              metric_name=kwargs[&#39;metric_name&#39;],
                                              method_name=kwargs[&#39;method_name&#39;]),
        &#39;content-plot.figure&#39;: _get_elite_content(mapelites=app_settings.current_mapelites,
                                                  bin_idx=None,
                                                  pop=None),
        &#39;spaceship-properties.children&#39;: get_properties_table(cs=None)
    }


def __bc_change(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    event_trig = kwargs[&#39;event_trig&#39;]
    b0 = kwargs[&#39;b0&#39;]
    b1 = kwargs[&#39;b1&#39;]
    curr_heatmap = kwargs[&#39;curr_heatmap&#39;]
        
    if event_trig.startswith(&#39;bc0&#39;) or event_trig.startswith(&#39;bc1&#39;):
        if event_trig.startswith(&#39;bc0&#39;):
            b0 = event_trig.replace(&#39;bc0-&#39;, &#39;&#39;).replace(&#39;_&#39;, &#39; / &#39;).replace(&#39;-&#39;, &#39; &#39;)
        else:
            b1 = event_trig.replace(&#39;bc1-&#39;, &#39;&#39;).replace(&#39;_&#39;, &#39; / &#39;).replace(&#39;-&#39;, &#39; &#39;)
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Updating feature descriptors to ({b0}, {b1})...&#39;)
        b0 = app_settings.behavior_descriptors[[b.name for b in app_settings.behavior_descriptors].index(b0)]
        b1 = app_settings.behavior_descriptors[[b.name for b in app_settings.behavior_descriptors].index(b1)]
        app_settings.current_mapelites.update_behavior_descriptors((b0, b1))
        curr_heatmap = _build_heatmap(mapelites=app_settings.current_mapelites,
                                      pop_name=kwargs[&#39;pop_name&#39;],
                                      metric_name=kwargs[&#39;metric_name&#39;],
                                      method_name=kwargs[&#39;method_name&#39;])
        logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Feature descriptors update completed.&#39;)
    else:
        logging.getLogger(&#39;webapp&#39;).error(msg=f&#39;Could not change BC: passed unrecognized value ({event_trig}).&#39;)
    
    return {
        &#39;heatmap-plot.figure&#39;: curr_heatmap,
        }


def __subdivide(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    curr_heatmap = kwargs[&#39;curr_heatmap&#39;]
    
    bin_idxs = [(x[1], x[0]) for x in app_settings.selected_bins]
    for bin_idx in bin_idxs:
        logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}.__subdivide] Subdividing {bin_idx=}&#39;)
        app_settings.current_mapelites.subdivide_range(bin_idx=bin_idx)
    curr_heatmap = _build_heatmap(mapelites=app_settings.current_mapelites,
                                  pop_name=kwargs[&#39;pop_name&#39;],
                                  metric_name=kwargs[&#39;metric_name&#39;],
                                  method_name=kwargs[&#39;method_name&#39;])
    logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Subdivided bin(s): {app_settings.selected_bins}.&#39;)
    app_settings.selected_bins = []
    
    return {
        &#39;heatmap-plot.figure&#39;: curr_heatmap,
        }


def __lsystem_modules(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    modules = kwargs[&#39;modules&#39;]
    
    all_modules = [x for x in app_settings.current_mapelites.lsystem.modules]
    names = [x.name for x in all_modules]
    for i, module in enumerate(names):
        if module in modules and not all_modules[i].active:
            # activate module
            app_settings.current_mapelites.toggle_module_mutability(module=module)
            logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}.__subdivide] Enabled {module}&#39;)
            break
        elif module not in modules and all_modules[i].active:
            # deactivate module
            app_settings.current_mapelites.toggle_module_mutability(module=module)
            logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}.__subdivide] Disabled {module}&#39;)
            break
    logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;L-system modules updated&#39;)

    return {}


def __update_rules(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    rules = kwargs[&#39;rules&#39;]
    
    new_rules = StochasticRules()
    for rule in rules.split(&#39;\n&#39;):
        lhs, p, rhs = rule.strip().split(&#39; &#39;)
        new_rules.add_rule(lhs=lhs,
                        rhs=rhs,
                        p=float(p))
    try:
        new_rules.validate()
        app_settings.current_mapelites.lsystem.hl_solver.parser.rules = new_rules
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;L-system rules updated.&#39;)
        return True
    except AssertionError as e:
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Failed updating L-system rules ({e}).&#39;)
    
    return {
        &#39;hl-rules.value&#39;: str(app_settings.current_mapelites.lsystem.hl_solver.parser.rules)
    }


def __fitness_weights(**kwargs) -&gt; Dict[str, Any]:
    global app_settings

    curr_heatmap = kwargs[&#39;curr_heatmap&#39;]
    weights = kwargs[&#39;weights&#39;]
    
    app_settings.current_mapelites.update_fitness_weights(weights=weights)
    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Updated fitness functions weights.&#39;)
    app_settings.hm_callback_props[&#39;metric&#39;][&#39;Fitness&#39;][&#39;zmax&#39;][&#39;feasible&#39;] = sum([x.weight * x.bounds[1] for x in app_settings.current_mapelites.feasible_fitnesses]) + app_settings.current_mapelites.nsc
    
    curr_heatmap = _build_heatmap(mapelites=app_settings.current_mapelites,
                                    pop_name=kwargs[&#39;pop_name&#39;],
                                    metric_name=kwargs[&#39;metric_name&#39;],
                                    method_name=kwargs[&#39;method_name&#39;])
    
    return {
        &#39;heatmap-plot.figure&#39;: curr_heatmap,
        }


def __update_heatmap(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    event_trig = kwargs[&#39;event_trig&#39;]
    pop_name = kwargs[&#39;pop_name&#39;]
    metric_name = kwargs[&#39;metric_name&#39;]
    method_name = kwargs[&#39;method_name&#39;]
    
    if event_trig == &#39;population-feasible&#39;:
        pop_name = &#39;Feasible&#39;
    elif event_trig == &#39;population-infeasible&#39;:
        pop_name = &#39;Infeasible&#39;
    elif event_trig == &#39;metric-fitness&#39;:
        metric_name = &#39;Fitness&#39;
    elif event_trig == &#39;metric-age&#39;:
        metric_name = &#39;Age&#39;
    elif event_trig == &#39;metric-coverage&#39;:
        metric_name = &#39;Coverage&#39;
    logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}.__update_heatmap] {pop_name=}; {metric_name=}; {method_name=}&#39;)

    curr_heatmap = _build_heatmap(mapelites=app_settings.current_mapelites,
                                    pop_name=pop_name,
                                    metric_name=metric_name,
                                    method_name=method_name)
    return {
        &#39;heatmap-plot.figure&#39;: curr_heatmap,
        }
    
    
def __apply_symmetry(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    event_trig = kwargs[&#39;event_trig&#39;]
    symm_orientation = kwargs[&#39;symm_orientation&#39;]
    
    logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Updating all solutions to enforce symmetry...&#39;)
    if event_trig == &#39;symmetry-none&#39;:
        symm_axis = &#39;None&#39;
    elif event_trig == &#39;symmetry-x&#39;:
        symm_axis = &#39;X-axis&#39;
    elif event_trig == &#39;symmetry-y&#39;:
        symm_axis = &#39;Y-axis&#39;
    elif event_trig == &#39;symmetry-z&#39;:
        symm_axis = &#39;Z-axis&#39;
    logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}.__apply_symmetry] {symm_axis=}; {symm_orientation=}&#39;)
        
    app_settings.current_mapelites.reassign_all_content(sym_axis=symm_axis[0].lower() if symm_axis != &#34;None&#34; else None,
                                                        sym_upper=symm_orientation == &#39;Upper&#39;)
    curr_content = _get_elite_content(mapelites=app_settings.current_mapelites,
                                      bin_idx=None,
                                      pop=None)
    logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Symmetry enforcement completed.&#39;)
    
    app_settings.selected_bins = []
    
    return {
        &#39;content-plot.figure&#39;: curr_content,
        &#39;content-string.value&#39;: &#39;&#39;,
        &#39;spaceship-properties.children&#39;: get_properties_table(),
        &#39;symmetry-dropdown.label&#39;: symm_axis
        }


def __update_content(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    curr_heatmap = kwargs[&#39;curr_heatmap&#39;]
    curr_content = kwargs[&#39;curr_content&#39;]
    cs_string = kwargs[&#39;cs_string&#39;]
    cs_properties = kwargs[&#39;cs_properties&#39;]
    voxel_display = kwargs[&#39;curr_voxel_display&#39;]
        
    i, j = kwargs[&#39;clickData&#39;][&#39;points&#39;][0][&#39;x&#39;], kwargs[&#39;clickData&#39;][&#39;points&#39;][0][&#39;y&#39;]
    if app_settings.current_mapelites.bins[j, i].non_empty(pop=&#39;feasible&#39; if kwargs[&#39;pop_name&#39;] == &#39;Feasible&#39; else &#39;infeasible&#39;):
        if (j, i) in [b.bin_idx for b in app_settings.current_mapelites._valid_bins()]:
            curr_content = _get_elite_content(mapelites=app_settings.current_mapelites,
                                              bin_idx=(j, i),
                                              pop=&#39;feasible&#39; if kwargs[&#39;pop_name&#39;] == &#39;Feasible&#39; else &#39;infeasible&#39;,
                                              camera=None,
                                              show_voxel=voxel_display)
            if app_settings.app_mode == AppMode.USERSTUDY:
                n_spaceships_inspected.add(1)
            if not app_settings.current_mapelites.enforce_qnt and app_settings.selected_bins != []:
                if (i, j) not in app_settings.selected_bins:
                    app_settings.selected_bins.append((i, j))
                else:
                    app_settings.selected_bins.remove((i, j))
            else:
                app_settings.selected_bins = [(i, j)]
            cs_string = &#39;&#39;
            cs_properties = get_properties_table()
            if len(app_settings.selected_bins) &gt; 0:
                elite = get_elite(mapelites=app_settings.current_mapelites,
                                  bin_idx=_switch([app_settings.selected_bins[-1]])[0],
                                  pop=&#39;feasible&#39; if kwargs[&#39;pop_name&#39;] == &#39;Feasible&#39; else &#39;infeasible&#39;)
                cs_string = elite.string
                cs_properties = get_properties_table(cs=elite)
                curr_heatmap = _build_heatmap(mapelites=app_settings.current_mapelites,
                                              pop_name=kwargs[&#39;pop_name&#39;],
                                              metric_name=kwargs[&#39;metric_name&#39;],
                                              method_name=kwargs[&#39;method_name&#39;])
    else:
        logging.getLogger(&#39;webapp&#39;).error(msg=f&#39;[{__name__}.__update_content] Empty bin selected: {(i, j)=}&#39;)
    
    return {
        &#39;heatmap-plot.figure&#39;: curr_heatmap,
        &#39;content-plot.figure&#39;: curr_content,
        &#39;content-string.value&#39;: cs_string,
        &#39;spaceship-properties.children&#39;: cs_properties,
        }


def __toggle_voxelization(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    curr_camera = kwargs[&#39;curr_camera&#39;] 
    voxel_display = kwargs[&#39;curr_voxel_display&#39;]
    
    lb = _switch([app_settings.selected_bins[-1]])[0]
    curr_content = _get_elite_content(mapelites=app_settings.current_mapelites,
                                      bin_idx=lb,
                                      pop=&#39;feasible&#39; if kwargs[&#39;pop_name&#39;] == &#39;Feasible&#39; else &#39;infeasible&#39;,
                                      camera=curr_camera.get(&#39;scene.camera&#39;, None),
                                      show_voxel=voxel_display)

    return {
        &#39;content-plot.figure&#39;: curr_content,
    }


def __selection(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    app_settings.current_mapelites.enforce_qnt = not app_settings.current_mapelites.enforce_qnt
    logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;MAP-Elites single bin selection set to {app_settings.current_mapelites.enforce_qnt}.&#39;)
    if app_settings.current_mapelites.enforce_qnt and app_settings.selected_bins:
        app_settings.selected_bins = [app_settings.selected_bins[-1]]
    
    return {}


def __clear_selection(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Cleared bins selection.&#39;)
    app_settings.selected_bins = []
    
    return {
        &#39;content-plot.figure&#39;:  _get_elite_content(mapelites=app_settings.current_mapelites,
                                                   bin_idx=None,
                                                   pop=None),
        &#39;content-string.value&#39;: &#39;&#39;,
        &#39;spaceship-properties.children&#39;: get_properties_table(),
        }


def __emitter(**kwargs) -&gt; Dict[str, Any]:
    global app_settings

    emitter_name = {
        &#39;emitter-human&#39;: &#39;Human&#39;,
        &#39;emitter-random&#39;: &#39;Random&#39;,
        &#39;emitter-greedy&#39;: &#39;Greedy&#39;,
        &#39;emitter-prefmatrix&#39;: &#39;Preference Matrix&#39;,
        &#39;emitter-prefbandit&#39;: &#39;Preference Bandit&#39;,
        &#39;emitter-conbandit&#39;: &#39;Contextual Bandit&#39;,
        &#39;emitter-knn&#39;: &#39;KNN&#39;,
        &#39;emitter-linkernel&#39;: &#39;Linear Kernel&#39;,
        &#39;emitter-rbfkernel&#39;: &#39;RBF Kernel&#39;
    }[kwargs[&#39;event_trig&#39;]]
    
    if emitter_name == &#39;Random&#39;:
        app_settings.current_mapelites.emitter = RandomEmitter()
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter set to {emitter_name}&#39;)
    if emitter_name == &#39;Greedy&#39;:
        app_settings.current_mapelites.emitter = GreedyEmitter()
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter set to {emitter_name}&#39;)
    elif emitter_name == &#39;Preference-matrix&#39;:
        app_settings.current_mapelites.emitter = HumanPrefMatrixEmitter()
        app_settings.current_mapelites.emitter._build_pref_matrix(bins=app_settings.current_mapelites.bins)
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter set to {emitter_name}&#39;)
    elif emitter_name == &#39;Contextual Bandit&#39;:
        app_settings.current_mapelites.emitter = ContextualBanditEmitter()
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter set to {emitter_name}&#39;)
    elif emitter_name == &#39;Preference Bandit&#39;:
        app_settings.current_mapelites.emitter = PreferenceBanditEmitter()
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter set to {emitter_name}&#39;)
    elif emitter_name == &#39;KNN&#39;:
        app_settings.current_mapelites.emitter = KNNEmitter()
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter set to {emitter_name}&#39;)
    elif emitter_name == &#39;Linear Kernel&#39;:
        app_settings.current_mapelites.emitter = LinearKernelEmitter()
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter set to {emitter_name}&#39;)
    elif emitter_name == &#39;RBF Kernel&#39;:
        app_settings.current_mapelites.emitter = RBFKernelEmitter()
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter set to {emitter_name}&#39;)
    elif emitter_name == &#39;Human&#39;:
        app_settings.current_mapelites.emitter = HumanEmitter()
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Emitter set to {emitter_name}&#39;)
    else:
        logging.getLogger(&#39;webapp&#39;).error(msg=f&#39;[{__name__}.__emitter] Unrecognized {emitter_name=}&#39;)

    return {
        &#39;emitter-dropdown.label&#39;: emitter_name
    }


def __content_download(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    global time_elapsed_user
    global time_elapsed_emitter
    global population_complexity
    global n_solutions_feas
    global n_solutions_infeas
    global n_spaceships_inspected
    global download_semaphore

    cs_string = kwargs[&#39;cs_string&#39;]
    cs_properties = kwargs[&#39;cs_properties&#39;]
    curr_heatmap = kwargs[&#39;curr_heatmap&#39;]
    curr_content = kwargs[&#39;curr_content&#39;]
    eous_modal_show = kwargs[&#39;eous_modal_show&#39;]
    qs_um_modal_show = kwargs[&#39;qs_um_modal_show&#39;]
    nbs_err_modal_show = kwargs[&#39;nbs_err_modal_show&#39;]
    rand_step_btn_style = kwargs[&#39;rand_step_btn_style&#39;]
    reset_btn_style = kwargs[&#39;reset_btn_style&#39;]
    exp_progress_style = kwargs[&#39;exp_progress_style&#39;]
    metrics_dl = None
    dlbtn_label = kwargs[&#39;dlbtn_label&#39;]
    
    # if cs_string != &#39;&#39;:
    if app_settings.selected_bins:
        
        logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.__content_download] (pre-check) {download_semaphore.is_locked=}&#39;)
        while download_semaphore.is_locked:
            pass
        logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.__content_download] (post-check) {download_semaphore.is_locked=}&#39;)
        download_semaphore.lock(name=download_semaphore._running)
        logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.__content_download] (re-lock) {download_semaphore.is_locked=}&#39;)
        
        if app_settings.app_mode == AppMode.USERSTUDY and app_settings.gen_counter == N_GENS_ALLOWED:
            app_settings.exp_n += 1
            # check end of user study
            if app_settings.exp_n &gt;= len(app_settings.my_emitterslist):
                curr_heatmap = go.Figure(
                    data=go.Heatmap(
                        z=np.zeros(0, dtype=object),
                        x=np.zeros(0, dtype=object),
                        y=np.zeros(0, dtype=object),
                        hoverongaps=False,
                        ))
                curr_content = _get_elite_content(mapelites=app_settings.current_mapelites,
                                                  bin_idx=None,
                                                  pop=None)
                cs_string = &#39;&#39;
                cs_properties = get_properties_table()
                if app_settings.app_mode == AppMode.USERSTUDY:
                    metrics_dl = dict(content=json.dumps({
                        &#39;time_elapsed_user&#39;: time_elapsed_user.history,
                        &#39;time_elapsed_emitter&#39;: time_elapsed_emitter.history,
                        &#39;n_interactions&#39;: n_spaceships_inspected.get_averages(),
                        &#39;avg_complexity&#39;: population_complexity.history,
                        &#39;n_solutions_feas&#39;: n_solutions_feas.history,
                        &#39;n_solutions_infeas&#39;: n_solutions_feas.history
                        }),
                                      filename=f&#39;user_metrics_{app_settings.rngseed}&#39;)
                else:
                    metrics_dl = None
                logging.getLogger(&#39;webapp&#39;).info(f&#39;Reached end of all experiments! Please go back to the questionnaire to continue the evaluation.&#39;)
                eous_modal_show = True
                qs_um_modal_show = True
                app_settings.app_mode = AppMode.USER
                dlbtn_label = &#39;Download&#39;
                app_settings.selected_bins = []
                with open(os.path.join(curr_folder, &#39;.userstudyover&#39;), &#39;w&#39;): pass
                logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Initializing a new population; this may take a while...&#39;)
                app_settings.current_mapelites.reset()
                app_settings.current_mapelites.hull_builder.apply_smoothing = False
                app_settings.current_mapelites.emitter = RandomEmitter()
                rand_step_btn_style, reset_btn_style, exp_progress_style = {}, {&#39;justify-content&#39;: &#39;center&#39;}, hidden_style
                curr_heatmap = _build_heatmap(mapelites=app_settings.current_mapelites,
                                              pop_name=kwargs[&#39;pop_name&#39;],
                                              metric_name=kwargs[&#39;metric_name&#39;],
                                              method_name=kwargs[&#39;method_name&#39;])
                curr_content = _get_elite_content(mapelites=app_settings.current_mapelites,
                                                  bin_idx=None,
                                                  pop=None)
                logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Initialization completed.&#39;)
            else:
                logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Reached end of experiment {app_settings.exp_n}! Loading the next experiment...&#39;)
                app_settings.gen_counter = 0
                dlbtn_label = &#39;Download&#39;
                app_settings.selected_bins = []
                if app_settings.app_mode == AppMode.USERSTUDY:
                    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Loading next population...&#39;)
                    app_settings.current_mapelites.reset(lcs=[])
                    app_settings.current_mapelites.hull_builder.apply_smoothing = False
                    app_settings.current_mapelites.load_population(filename=app_settings.my_emitterslist[app_settings.exp_n])
                    app_settings.current_mapelites.emitter = _get_emitter()
                    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Next population loaded.&#39;)
                    n_spaceships_inspected.new_generation(emitters=app_settings.my_emitterslist,
                                                          exp_n=app_settings.exp_n)
                    time_elapsed_user.new_generation(emitters=app_settings.my_emitterslist,
                                                     exp_n=app_settings.exp_n)
                    time_elapsed_emitter.new_generation(emitters=app_settings.my_emitterslist,
                                                        exp_n=app_settings.exp_n)
                    population_complexity.new_generation(emitters=app_settings.my_emitterslist,
                                                         exp_n=app_settings.exp_n)
                    n_solutions_feas.new_generation(emitters=app_settings.my_emitterslist,
                                                    exp_n=app_settings.exp_n)
                    n_solutions_infeas.new_generation(emitters=app_settings.my_emitterslist,
                                                      exp_n=app_settings.exp_n)
                    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Next experiment loaded. Please fill out the questionnaire before continuing.&#39;)
                else:
                    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Initializing a new population; this may take a while...&#39;)
                    app_settings.current_mapelites.reset()
                    app_settings.current_mapelites.hull_builder.apply_smoothing = False
                    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Initialization completed.&#39;)
                curr_heatmap = _build_heatmap(mapelites=app_settings.current_mapelites,
                                              pop_name=kwargs[&#39;pop_name&#39;],
                                              metric_name=kwargs[&#39;metric_name&#39;],
                                              method_name=kwargs[&#39;method_name&#39;])
                curr_content = _get_elite_content(mapelites=app_settings.current_mapelites,
                                                  bin_idx=None,
                                                  pop=None)
                cs_string = &#39;&#39;
                cs_properties = get_properties_table()
            # update base color on new experiment switch
            _update_base_color(color=base_color)
    else:
        nbs_err_modal_show = True

    logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.__content_download] {app_settings.selected_bins=}; {app_settings.exp_n=}; {app_settings.gen_counter=}&#39;)
    
    return {
        &#39;heatmap-plot.figure&#39;: curr_heatmap,
        &#39;content-plot.figure&#39;: curr_content,
        &#39;content-string.value&#39;: cs_string,
        &#39;spaceship-properties.children&#39;: cs_properties,
        &#39;nbs-err-modal.is_open&#39;: nbs_err_modal_show,
        &#39;eous-modal.is_open&#39;: eous_modal_show,
        &#39;quickstart-usermode-modal.is_open&#39;: qs_um_modal_show,
        &#39;rand-step-btn-div.style&#39;: rand_step_btn_style,
        &#39;reset-btn-div.style&#39;: reset_btn_style,
        &#39;exp-progress-div.style&#39;: exp_progress_style,
        &#39;download-metrics.data&#39;: metrics_dl,
        &#39;download-btn.children&#39;: dlbtn_label
    }


def __population_download(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    content_dl = dict(content=json.dumps([b.to_json() for b in app_settings.current_mapelites.bins.flatten().tolist()]),
                      filename=f&#39;population_{app_settings.rngseed}_exp{app_settings.exp_n}_{app_settings.current_mapelites.emitter.name}.json&#39;)
    logging.getLogger(&#39;webapp&#39;).info(f&#39;The population will be downloaded shortly.&#39;)
    return {
        &#39;download-population.data&#39;: content_dl
    }


def __population_upload(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    upload_filename = kwargs[&#39;upload_filename&#39;]
    
    logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Setting population from file...&#39;)
    # _, upload_contents = upload_contents.split(&#39;,&#39;)
    # upload_contents = base64.b64decode(upload_contents).decode()
    app_settings.current_mapelites.load_population(filename=upload_filename)       
    # all_bins = np.asarray([MAPBin.from_json(x) for x in json.loads(upload_contents)])
    # app_settings.current_mapelites.reset(lcs=[])
    # all_bins = all_bins.reshape(app_settings.current_mapelites.bin_qnt)
    # app_settings.current_mapelites.bins = all_bins
    # app_settings.current_mapelites.reassign_all_content()
    logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Set population from file successfully.&#39;)
    app_settings.gen_counter = 0
    app_settings.selected_bins = []
    _update_base_color(color=base_color)

    return {
        &#39;heatmap-plot.figure&#39;: _build_heatmap(mapelites=app_settings.current_mapelites,
                                              pop_name=kwargs[&#39;pop_name&#39;],
                                              metric_name=kwargs[&#39;metric_name&#39;],
                                              method_name=kwargs[&#39;method_name&#39;]),
        &#39;content-plot.figure&#39;: _get_elite_content(mapelites=app_settings.current_mapelites,
                                                  bin_idx=None,
                                                  pop=None),
        &#39;spaceship-properties.children&#39;: get_properties_table(cs=None)
        }


def __consent(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    nclicks_yes = kwargs[&#39;nclicks_yes&#39;]
    nclicks_no = kwargs[&#39;nclicks_no&#39;]
    qs_modal_show = kwargs[&#39;qs_modal_show&#39;]
    qs_um_modal_show = kwargs[&#39;qs_um_modal_show&#39;]
    rand_step_btn_style = kwargs[&#39;rand_step_btn_style&#39;]
    reset_btn_style = kwargs[&#39;reset_btn_style&#39;]
    exp_progress_style = kwargs[&#39;exp_progress_style&#39;]
    cm_modal_show = kwargs[&#39;cm_modal_show&#39;]
    study_style = kwargs[&#39;study_style&#39;]
    
    app_settings.app_mode = AppMode.USERSTUDY if nclicks_yes else AppMode.USER if nclicks_no else None
    if nclicks_yes:
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Thank you for participating in the user study! Please do not refresh the page.&#39;)
        logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Loading population...&#39;)
        app_settings.current_mapelites.reset(lcs=[])
        app_settings.current_mapelites.hull_builder.apply_smoothing = False
        app_settings.current_mapelites.load_population(filename=app_settings.my_emitterslist[app_settings.exp_n])
        logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Population loaded.&#39;)
        qs_modal_show = True
    else:
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;No user data will be collected during this session. Please do not refresh the page.&#39;)
        logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Initializing population; this may take a while...&#39;)
        app_settings.current_mapelites.emitter = RandomEmitter()
        app_settings.current_mapelites.reset()
        app_settings.current_mapelites.hull_builder.apply_smoothing = False
        logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Initialization completed.&#39;)
        qs_um_modal_show = True
        rand_step_btn_style, reset_btn_style, exp_progress_style, study_style = {}, {&#39;justify-content&#39;: &#39;center&#39;}, hidden_style, hidden_style
    cm_modal_show = False
    app_settings.gen_counter = 0
    
    return {
        &#39;heatmap-plot.figure&#39;: _build_heatmap(mapelites=app_settings.current_mapelites,
                                              pop_name=kwargs[&#39;pop_name&#39;],
                                              metric_name=kwargs[&#39;metric_name&#39;],
                                              method_name=kwargs[&#39;method_name&#39;]),
        &#39;consent-modal.is_open&#39;: cm_modal_show,
        &#39;quickstart-modal.is_open&#39;: qs_modal_show,
        &#39;quickstart-usermode-modal.is_open&#39;: qs_um_modal_show,
        &#39;rand-step-btn-div.style&#39;: rand_step_btn_style,
        &#39;reset-btn-div.style&#39;: reset_btn_style,
        &#39;exp-progress-div.style&#39;: exp_progress_style,
        &#39;study-progress-div.style&#39;: study_style,
        &#39;qus-div.style&#39;: {} if app_settings.app_mode == AppMode.USERSTUDY else hidden_style
        }


def __close_error(**kwargs) -&gt; Dict[str, Any]:
    return {&#39;nbs-err-modal.is_open&#39;: False}


def _update_base_color(color: Vec) -&gt; None:
    global app_settings
    logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}._update_base_color] {color=}&#39;)
    for (_, _), b in np.ndenumerate(app_settings.current_mapelites.bins):
            for cs in [*b._feasible, *b._infeasible]:
                cs.base_color = color
                cs.content.set_color(color)


def __color(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    global base_color
    
    color = kwargs[&#39;color&#39;]
    curr_content = kwargs[&#39;curr_content&#39;]
    curr_camera = kwargs[&#39;curr_camera&#39;]
    voxel_display = kwargs[&#39;curr_voxel_display&#39;]
    
    r, g, b = tuple(int(color.lstrip(&#39;#&#39;)[i:i+2], 16) for i in (0, 2, 4))
    new_color = Vec.v3f(r, g, b).scale(1 / 256)
    base_color = new_color
    logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}.__color] {base_color=}&#39;)
    _update_base_color(color=base_color)
    if app_settings.selected_bins:
        curr_content =  _get_elite_content(mapelites=app_settings.current_mapelites,
                                           bin_idx=_switch([app_settings.selected_bins[-1]])[0],
                                           pop=&#39;feasible&#39; if kwargs[&#39;pop_name&#39;] == &#39;Feasible&#39; else &#39;infeasible&#39;,
                                           camera=curr_camera.get(&#39;scene.camera&#39;, None),
                                           show_voxel=voxel_display)
    return {
        &#39;content-plot.figure&#39;: curr_content,
        &#39;content-legend-div.children&#39;: get_content_legend()
    }


def __show_quickstart_modal(**kwargs) -&gt; Dict[str, Any]:
    return {
        &#39;quickstart-modal.is_open&#39;: app_settings.app_mode == AppMode.USERSTUDY,
        &#39;quickstart-usermode-modal.is_open&#39;: app_settings.app_mode == AppMode.USER
    }


def __default(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    
    return {
        &#39;heatmap-plot.figure&#39;: _build_heatmap(mapelites=app_settings.current_mapelites,
                                              pop_name=kwargs[&#39;pop_name&#39;],
                                              metric_name=kwargs[&#39;metric_name&#39;],
                                              method_name=kwargs[&#39;method_name&#39;]),
        &#39;content-plot.figure&#39;: _get_elite_content(mapelites=app_settings.current_mapelites,
                                                  bin_idx=None,
                                                  pop=None)
        }


def __quit_user_study(**kwargs) -&gt; Dict[str, Any]:
    global app_settings
    global n_spaceships_inspected
    global time_elapsed_user
    global time_elapsed_emitter
    global population_complexity
    global n_solutions_feas
    global n_solutions_infeas
    
    logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;Switching mode from {app_settings.app_mode} to {AppMode.USER}...&#39;)
    app_settings.app_mode = AppMode.USER
    logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;No user data will be collected during this session. Please do not refresh the page.&#39;)
    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Initializing population; this may take a while...&#39;)
    app_settings.current_mapelites.emitter = RandomEmitter()
    app_settings.current_mapelites.reset()
    app_settings.current_mapelites.hull_builder.apply_smoothing = False
    logging.getLogger(&#39;webapp&#39;).info(msg=&#39;Initialization completed.&#39;)
    app_settings.gen_counter = 0    
    app_settings.selected_bins = []
    _update_base_color(color=base_color)
    
    n_spaceships_inspected.reset()
    time_elapsed_user.reset()
    time_elapsed_emitter.reset()
    population_complexity.reset()
    n_solutions_feas.reset()
    n_solutions_infeas.reset()
    
    return {
        &#39;heatmap-plot.figure&#39;: _build_heatmap(mapelites=app_settings.current_mapelites,
                                              pop_name=kwargs[&#39;pop_name&#39;],
                                              metric_name=kwargs[&#39;metric_name&#39;],
                                              method_name=kwargs[&#39;method_name&#39;]),
        &#39;consent-modal.is_open&#39;: False,
        &#39;quickstart-usermode-modal.is_open&#39;: True,
        &#39;rand-step-btn-div.style&#39;: {},
        &#39;reset-btn-div.style&#39;: {&#39;justify-content&#39;: &#39;center&#39;},
        &#39;exp-progress-div.style&#39;: hidden_style,
        &#39;study-progress-div.style&#39;: hidden_style,
        &#39;qus-div.style&#39;: hidden_style,
        &#39;eus-modal.is_open&#39;: False,
        &#39;content-plot.figure&#39;: _get_elite_content(mapelites=app_settings.current_mapelites,
                                                  bin_idx=None,
                                                  pop=None),
        &#39;spaceship-properties.children&#39;: get_properties_table(cs=None)
        }


def __show_quit_user_study_modal(**kwargs) -&gt; Dict[str, Any]:
    return {
        &#39;eus-modal.is_open&#39;: True
    }


triggers_map = {
    &#39;step-btn&#39;: __apply_step,
    &#39;rand-step-btn&#39;: __apply_step,
    &#39;reset-btn&#39;: __reset,
    &#39;bc0-Major-axis_Medium-axis&#39;: __bc_change,
    &#39;bc0-Major-axis_Smallest-axis&#39;: __bc_change,
    &#39;bc0-Average-Proportions&#39;: __bc_change,
    &#39;bc0-Symmetry&#39;: __bc_change,
    &#39;bc1-Major-axis_Medium-axis&#39;: __bc_change,
    &#39;bc1-Major-axis_Smallest-axis&#39;: __bc_change,
    &#39;bc1-Average-Proportions&#39;: __bc_change,
    &#39;bc1-Symmetry&#39;: __bc_change,
    &#39;subdivide-btn&#39;: __subdivide,
    &#39;lsystem-modules&#39;: __lsystem_modules,
    &#39;update-rules-btn&#39;: __update_rules,
    &#39;population-feasible&#39;: __update_heatmap,
    &#39;population-infeasible&#39;: __update_heatmap,
    &#39;metric-fitness&#39;: __update_heatmap,
    &#39;metric-age&#39;: __update_heatmap,
    &#39;metric-coverage&#39;: __update_heatmap,
    &#39;method-radio&#39;: __update_heatmap,
    &#39;symmetry-none&#39;: __apply_symmetry,
    &#39;symmetry-x&#39;: __apply_symmetry,
    &#39;symmetry-y&#39;: __apply_symmetry,
    &#39;symmetry-z&#39;: __apply_symmetry,
    &#39;symmetry-radio&#39;: __apply_symmetry,
    &#39;heatmap-plot&#39;: __update_content,
    &#39;population_dropdown&#39;: __update_content,
    &#39;selection-btn&#39;: __selection,
    &#39;selection-clr-btn&#39;: __clear_selection,
    &#39;emitter-human&#39;: __emitter,
    &#39;emitter-random&#39;: __emitter,
    &#39;emitter-greedy&#39;: __emitter,
    &#39;emitter-prefmatrix&#39;: __emitter,
    &#39;emitter-prefbandit&#39;: __emitter,
    &#39;emitter-conbandit&#39;: __emitter,
    &#39;emitter-knn&#39;: __emitter,
    &#39;emitter-linkernel&#39;: __emitter,
    &#39;emitter-rbfkernel&#39;: __emitter,
    &#39;download-btn&#39;: __content_download,
    &#39;popdownload-btn&#39;: __population_download,
    &#39;popupload-data&#39;: __population_upload,
    &#39;consent-yes&#39;: __consent,
    &#39;consent-no&#39;: __consent,
    &#39;nbs-err-btn&#39;: __close_error,
    &#39;color-picker-btn&#39;: __color,
    &#39;fitness-sldr&#39;: __fitness_weights,
    &#39;webapp-quickstart-btn&#39;: __show_quickstart_modal,
    &#39;qus-btn&#39;: __show_quit_user_study_modal,
    &#39;qus-y-btn&#39;: __quit_user_study,
    &#39;voxel-preview-toggle&#39;: __toggle_voxelization,
    None: __default
}


@app.callback(Output(&#39;heatmap-plot&#39;, &#39;figure&#39;),
              Output(&#39;content-plot&#39;, &#39;figure&#39;),
              Output(&#39;hl-rules&#39;, &#39;value&#39;),
              Output(&#39;selected-bin&#39;, &#39;children&#39;),
              Output(&#39;content-string&#39;, &#39;value&#39;),
              Output(&#39;spaceship-properties&#39;, &#39;children&#39;),
              Output(&#39;step-spinner&#39;, &#39;children&#39;),
              Output(&#34;download-population&#34;, &#34;data&#34;),
              Output(&#34;download-metrics&#34;, &#34;data&#34;),
              Output(&#39;population-dropdown&#39;, &#39;label&#39;),
              Output(&#39;metric-dropdown&#39;, &#39;label&#39;),
              Output(&#39;b0-dropdown&#39;, &#39;label&#39;),
              Output(&#39;b1-dropdown&#39;, &#39;label&#39;),
              Output(&#39;symmetry-dropdown&#39;, &#39;label&#39;),
              Output(&#34;quickstart-modal&#34;, &#34;is_open&#34;),
              Output(&#34;quickstart-usermode-modal&#34;, &#34;is_open&#34;),
              Output(&#34;consent-modal&#34;, &#34;is_open&#34;),
              Output(&#34;nbs-err-modal&#34;, &#34;is_open&#34;),
              Output(&#34;eoe-modal&#34;, &#34;is_open&#34;),
              Output(&#34;eous-modal&#34;, &#34;is_open&#34;),
              Output(&#34;rand-step-btn-div&#34;, &#34;style&#34;),
              Output(&#34;reset-btn-div&#34;, &#34;style&#34;),
              Output(&#34;exp-progress-div&#34;, &#34;style&#34;),
              Output(&#39;study-progress-div&#39;, &#39;style&#39;),
              Output(&#39;download-btn&#39;, &#39;children&#39;),
              Output(&#39;content-legend-div&#39;, &#39;children&#39;),
              Output(&#39;qus-div&#39;, &#39;style&#39;),
              Output(&#34;eus-modal&#34;, &#34;is_open&#34;),
              Output(&#39;emitter-dropdown&#39;, &#39;label&#39;),
                            
              State(&#39;heatmap-plot&#39;, &#39;figure&#39;),
              State(&#39;hl-rules&#39;, &#39;value&#39;),
              State(&#39;content-plot&#39;, &#39;figure&#39;),
              State(&#39;content-string&#39;, &#39;value&#39;),
              State(&#39;spaceship-properties&#39;, &#39;children&#39;),
              State(&#39;population-dropdown&#39;, &#39;label&#39;),
              State(&#39;metric-dropdown&#39;, &#39;label&#39;),
              State(&#39;b0-dropdown&#39;, &#39;label&#39;),
              State(&#39;b1-dropdown&#39;, &#39;label&#39;),
              State(&#39;symmetry-dropdown&#39;, &#39;label&#39;),
              State(&#39;emitter-dropdown&#39;, &#39;label&#39;),
              State(&#34;quickstart-modal&#34;, &#34;is_open&#34;),
              State(&#34;quickstart-usermode-modal&#34;, &#34;is_open&#34;),
              State(&#34;consent-modal&#34;, &#34;is_open&#34;),
              State(&#34;nbs-err-modal&#34;, &#34;is_open&#34;),
              State(&#34;eoe-modal&#34;, &#34;is_open&#34;),
              State(&#34;eous-modal&#34;, &#34;is_open&#34;),
              State(&#34;rand-step-btn-div&#34;, &#34;style&#34;),
              State(&#34;reset-btn-div&#34;, &#34;style&#34;),
              State(&#34;exp-progress-div&#34;, &#34;style&#34;),
              State(&#39;study-progress-div&#39;, &#39;style&#39;),
              State(&#39;download-btn&#39;, &#39;children&#39;),
              State(&#39;content-legend-div&#39;, &#39;children&#39;),
              State(&#34;eus-modal&#34;, &#34;is_open&#34;),
              State(&#39;color-picker&#39;, &#39;value&#39;),
              State(&#34;content-plot&#34;, &#34;relayoutData&#34;),
              State(&#34;voxel-preview-toggle&#34;, &#34;value&#34;),
                            
              Input(&#39;population-feasible&#39;, &#39;n_clicks&#39;),
              Input(&#39;population-infeasible&#39;, &#39;n_clicks&#39;),
              Input(&#39;metric-fitness&#39;, &#39;n_clicks&#39;),
              Input(&#39;metric-age&#39;, &#39;n_clicks&#39;),
              Input(&#39;metric-coverage&#39;, &#39;n_clicks&#39;),
              Input(&#39;method-radio&#39;, &#39;value&#39;),
              Input(&#39;step-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;rand-step-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;reset-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;subdivide-btn&#39;, &#39;n_clicks&#39;),
              Input({&#39;type&#39;: &#39;fitness-sldr&#39;, &#39;index&#39;: ALL}, &#39;value&#39;),
              Input(&#39;bc0-Major-axis_Medium-axis&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc0-Major-axis_Smallest-axis&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc0-Average-Proportions&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc0-Symmetry&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc1-Major-axis_Medium-axis&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc1-Major-axis_Smallest-axis&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc1-Average-Proportions&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc1-Symmetry&#39;, &#39;n_clicks&#39;),
              Input(&#39;lsystem-modules&#39;, &#39;value&#39;),
              Input(&#39;update-rules-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;heatmap-plot&#39;, &#39;clickData&#39;),
              Input(&#39;selection-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;selection-clr-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-human&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-random&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-greedy&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-prefmatrix&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-prefbandit&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-conbandit&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-knn&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-linkernel&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-rbfkernel&#39;, &#39;n_clicks&#39;),
              Input(&#34;download-btn&#34;, &#34;n_clicks&#34;),
              Input(&#39;popdownload-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;popupload-data&#39;, &#39;filename&#39;),
              Input(&#39;symmetry-none&#39;, &#39;n_clicks&#39;),
              Input(&#39;symmetry-x&#39;, &#39;n_clicks&#39;),
              Input(&#39;symmetry-y&#39;, &#39;n_clicks&#39;),
              Input(&#39;symmetry-z&#39;, &#39;n_clicks&#39;),
              Input(&#39;symmetry-radio&#39;, &#39;value&#39;),
              Input(&#34;consent-yes&#34;, &#34;n_clicks&#34;),
              Input(&#34;consent-no&#34;, &#34;n_clicks&#34;),
              Input(&#34;nbs-err-btn&#34;, &#34;n_clicks&#34;),
              Input(&#39;color-picker-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;webapp-quickstart-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;qus-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;qus-y-btn&#39;, &#39;n_clicks&#39;),
              Input(&#34;voxel-preview-toggle&#34;, &#34;value&#34;),
              )
def general_callback(curr_heatmap, rules, curr_content, cs_string, cs_properties, pop_name, metric_name, b0, b1, symm_axis, emitter_name, qs_modal_show, qs_um_modal_show, cm_modal_show, nbs_err_modal_show, eoe_modal_show, eous_modal_show, rand_step_btn_style, reset_btn_style, exp_progress_style, study_style, dlbtn_label, curr_legend, eus_modal_show, color, curr_camera, curr_voxel_display,
                     pop_feas, pop_infeas, metric_fitness, metric_age, metric_coverage, method_name, n_clicks_step, n_clicks_rand_step, n_clicks_reset, n_clicks_sub, weights, b0_mame, b0_mami, b0_avgp, b0_sym, b1_mame, b1_mami, b1_avgp, b1_sym, modules, n_clicks_rules, clickData, selection_btn, clear_btn, emitter1_nclicks, emitter2_nclicks, emitter3_nclicks, emitter4_nclicks, emitter5_nclicks, emitter6_nclicks, emitter7_nclicks, emitter8_nclicks, emitter9_nclicks, n_clicks_cs_download, n_clicks_popdownload, upload_filename, symm_none, symm_x, symm_y, symm_z, symm_orientation, nclicks_yes, nclicks_no, nbs_btn, color_btn, qs_btn, qus_btn, qus_y_btn, switch_voxel_display):
    global app_settings
    
    ctx = dash.callback_context

    if not ctx.triggered:
        event_trig = None
    else:
        event_trig = ctx.triggered[0][&#39;prop_id&#39;].split(&#39;.&#39;)[0]

    if event_trig not in triggers_map:
        try:
            import ast
            event_trig = ast.literal_eval(event_trig)
            event_trig = event_trig[&#39;type&#39;]
        except ValueError:
            logging.getLogger(&#39;webapp&#39;).error(msg=f&#39;[{__name__}.general_callback] Unrecognized {event_trig=}. No operations have been applied!&#39;)
    
    vars = locals()
    
    output = {
        &#39;heatmap-plot.figure&#39;: curr_heatmap,
        &#39;content-plot.figure&#39;: curr_content,
        &#39;hl-rules.value&#39;: rules,
        &#39;selected-bin.children&#39;: &#39;&#39;,
        &#39;content-string.value&#39;: cs_string,
        &#39;spaceship-properties.children&#39;: cs_properties,
        &#39;step-spinner.children&#39;: &#39;&#39;,
        &#39;download-population.data&#39;: None,
        &#39;download-metrics.data&#39;: None,
        &#39;population-dropdown.label&#39;: pop_name,
        &#39;metric-dropdown.label&#39;: metric_name,
        &#39;b0-dropdown.label&#39;: b0,
        &#39;b1-dropdown.label&#39;: b1,
        &#39;symmetry-dropdown.label&#39;: symm_axis,
        &#39;quickstart-modal.is_open&#39;: qs_modal_show,
        &#39;quickstart-usermode-modal.is_open&#39;: qs_um_modal_show,
        &#39;consent-modal.is_open&#39;: cm_modal_show if app_settings.app_mode is not None else True,
        &#39;nbs-err-modal.is_open&#39;: nbs_err_modal_show,
        &#39;eoe-modal.is_open&#39;: eoe_modal_show,
        &#39;eous-modal.is_open&#39;: eous_modal_show,
        &#39;rand-step-btn-div.style&#39;: rand_step_btn_style,
        &#39;reset-btn-div.style&#39;: reset_btn_style,
        &#39;exp-progress-div.style&#39;: exp_progress_style,
        &#39;study-progress-div.style&#39;: study_style,
        &#39;download-btn.children&#39;: dlbtn_label,
        &#39;content-legend-div.children&#39;: curr_legend,
        &#39;qus-div.style&#39;: {&#39;text-align&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.USERSTUDY else hidden_style,
        &#39;eus-modal.is_open&#39;: eus_modal_show,
        &#39;emitter-dropdown.label&#39;: emitter_name
    }
    
    # logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.general_callback] {event_trig=}; {app_settings.exp_n=}; {app_settings.gen_counter=}; {app_settings.selected_bins=}; {app_settings.current_mapelites.emitter.name=}; {app_settings.current_mapelites.emitter.sampling_strategy=}; {process_semaphore.is_locked=}&#39;)
    logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.general_callback] {event_trig=}; {app_settings.exp_n=}; {app_settings.gen_counter=}; {app_settings.selected_bins=}; {app_settings.current_mapelites.emitter.name=}; {process_semaphore.is_locked=}&#39;)
    
    for metric in all_metrics:
        logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.general_callback] metric={metric.name}; {metric.history=}&#39;)
    
    if not process_semaphore.is_locked:
        process_semaphore.lock(name=event_trig)

        u = triggers_map[event_trig](**vars)
        for k in u.keys():
            output[k] = u[k]

        app_settings.selected_bins, selected_bins_str = _format_bins(mapelites=app_settings.current_mapelites,
                                                                     bins_idx_list=app_settings.selected_bins,
                                                                     do_switch=True,
                                                                     str_prefix=&#39;Selected bin(s):&#39;,
                                                                     filter_out_empty=True) 
        
        output[&#39;selected-bin.children&#39;] = selected_bins_str
        
        if app_settings.selected_bins and len(curr_content[&#39;data&#39;]) == 0:
            output[&#39;content-plot.figure&#39;] = _get_elite_content(mapelites=app_settings.current_mapelites,
                                                               bin_idx=_switch([app_settings.selected_bins[-1]])[0],
                                                               pop=&#39;feasible&#39;,
                                                               camera=curr_camera.get(&#39;scene.camera&#39;, None),
                                                               show_voxel=curr_voxel_display)
        
        process_semaphore.unlock()
    
    return tuple(output.values())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pcgsepy.guis.main_webapp.webapp.disable_privacy_modal"><code class="name flex">
<span>def <span class="ident">disable_privacy_modal</span></span>(<span>ny, nn)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    Output(&#34;consent-yes&#34;, &#34;disabled&#34;),
    Output(&#34;consent-no&#34;, &#34;disabled&#34;),
    Input(&#34;consent-yes&#34;, &#34;n_clicks&#34;),
    Input(&#34;consent-no&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def disable_privacy_modal(ny, nn):
    return True, True</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.download_content"><code class="name flex">
<span>def <span class="ident">download_content</span></span>(<span>curr_content, curr_camera, n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    Output(&#34;download-content&#34;, &#34;data&#34;),
    Output(&#39;download-spinner&#39;, &#39;children&#39;),
    State(&#39;content-plot&#39;, &#39;figure&#39;),
    State(&#34;content-plot&#34;, &#34;relayoutData&#34;),
    Input(&#34;download-btn&#34;, &#34;n_clicks&#34;),
    # prevent_initial_call=True,
)
def download_content(curr_content, curr_camera,
                     n):
    global base_color
    global download_semaphore
    
        
    def write_archive(bytes_io):
        with ZipFile(bytes_io, mode=&#34;w&#34;) as zf:
            # with open(&#39;./assets/thumb.png&#39;, &#39;rb&#39;) as f:
            #     thumbnail_img = f.read()
            content_fig = go.Figure(data=curr_content[&#39;data&#39;],
                                     layout=curr_content[&#39;layout&#39;])
            content_fig.update_layout(scene_camera=curr_camera)
            thumbnail_img = content_fig.to_image(format=&#34;png&#34;)
            zf.writestr(&#39;thumb.png&#39;, thumbnail_img)
            elite = get_elite(mapelites=app_settings.current_mapelites,
                              bin_idx=_switch([app_settings.selected_bins[-1]])[0],
                              pop=&#39;feasible&#39;)
            tmp = CandidateSolution(string=elite.string)
            tmp.ll_string = elite.ll_string
            tmp.base_color = elite.base_color
            app_settings.current_mapelites.lsystem._set_structure(cs=tmp)
            hullbuilder = HullBuilder(erosion_type=app_settings.current_mapelites.hull_builder.erosion_type,
                                      apply_erosion=True,
                                      apply_smoothing=True)
            download_semaphore.unlock()
            download_semaphore._running = &#39;YES&#39;           
            logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.write_archive] {download_semaphore.is_locked=}&#39;)
            hullbuilder.add_external_hull(tmp.content)
            tmp.content.set_color(tmp.base_color)
            logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.write_archive] {tmp.string=}; {tmp.content=}; {tmp.base_color=}&#39;)
            zf.writestr(&#39;bp.sbc&#39;, convert_structure_to_xml(structure=tmp.content, name=f&#39;My Spaceship ({app_settings.rngseed}) (exp{app_settings.exp_n})&#39;))
            content_properties = {
                &#39;string&#39;: tmp.string,
                &#39;base_color&#39;: tmp.base_color.as_dict()
            }
            zf.writestr(f&#39;spaceship_{app_settings.rngseed}_exp{app_settings.exp_n}&#39;, json.dumps(content_properties))
            download_semaphore._running = &#39;NO&#39;
    
    if app_settings.selected_bins:
        logging.getLogger(&#39;webapp&#39;).info(f&#39;Your selected spaceship will be downloaded shortly.&#39;)
        return dcc.send_bytes(write_archive, f&#39;MySpaceship_{app_settings.rngseed}_exp{app_settings.exp_n}_gen{app_settings.gen_counter}.zip&#39;), &#39;\n\n&#39;
    else:
        return None, &#39;\n\n&#39;</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.download_mapelites"><code class="name flex">
<span>def <span class="ident">download_mapelites</span></span>(<span>n_clicks)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    Output(&#34;download-mapelites&#34;, &#34;data&#34;),
    Input(&#34;download-mapelites-btn&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True,
)
def download_mapelites(n_clicks):    
    t = datetime.now().strftime(&#34;%Y%m%d%H%M%S&#34;)
    fname = f&#39;{t}_mapelites_{app_settings.current_mapelites.emitter.name}_gen{app_settings.gen_counter:02}&#39;
    logging.getLogger(&#39;webapp&#39;).info(f&#39;The MAP-Elites object will be downloaded shortly.&#39;)
    return dict(content=json_dumps(app_settings.current_mapelites), filename=f&#39;{fname}.json&#39;)</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.general_callback"><code class="name flex">
<span>def <span class="ident">general_callback</span></span>(<span>curr_heatmap, rules, curr_content, cs_string, cs_properties, pop_name, metric_name, b0, b1, symm_axis, emitter_name, qs_modal_show, qs_um_modal_show, cm_modal_show, nbs_err_modal_show, eoe_modal_show, eous_modal_show, rand_step_btn_style, reset_btn_style, exp_progress_style, study_style, dlbtn_label, curr_legend, eus_modal_show, color, curr_camera, curr_voxel_display, pop_feas, pop_infeas, metric_fitness, metric_age, metric_coverage, method_name, n_clicks_step, n_clicks_rand_step, n_clicks_reset, n_clicks_sub, weights, b0_mame, b0_mami, b0_avgp, b0_sym, b1_mame, b1_mami, b1_avgp, b1_sym, modules, n_clicks_rules, clickData, selection_btn, clear_btn, emitter1_nclicks, emitter2_nclicks, emitter3_nclicks, emitter4_nclicks, emitter5_nclicks, emitter6_nclicks, emitter7_nclicks, emitter8_nclicks, emitter9_nclicks, n_clicks_cs_download, n_clicks_popdownload, upload_filename, symm_none, symm_x, symm_y, symm_z, symm_orientation, nclicks_yes, nclicks_no, nbs_btn, color_btn, qs_btn, qus_btn, qus_y_btn, switch_voxel_display)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(Output(&#39;heatmap-plot&#39;, &#39;figure&#39;),
              Output(&#39;content-plot&#39;, &#39;figure&#39;),
              Output(&#39;hl-rules&#39;, &#39;value&#39;),
              Output(&#39;selected-bin&#39;, &#39;children&#39;),
              Output(&#39;content-string&#39;, &#39;value&#39;),
              Output(&#39;spaceship-properties&#39;, &#39;children&#39;),
              Output(&#39;step-spinner&#39;, &#39;children&#39;),
              Output(&#34;download-population&#34;, &#34;data&#34;),
              Output(&#34;download-metrics&#34;, &#34;data&#34;),
              Output(&#39;population-dropdown&#39;, &#39;label&#39;),
              Output(&#39;metric-dropdown&#39;, &#39;label&#39;),
              Output(&#39;b0-dropdown&#39;, &#39;label&#39;),
              Output(&#39;b1-dropdown&#39;, &#39;label&#39;),
              Output(&#39;symmetry-dropdown&#39;, &#39;label&#39;),
              Output(&#34;quickstart-modal&#34;, &#34;is_open&#34;),
              Output(&#34;quickstart-usermode-modal&#34;, &#34;is_open&#34;),
              Output(&#34;consent-modal&#34;, &#34;is_open&#34;),
              Output(&#34;nbs-err-modal&#34;, &#34;is_open&#34;),
              Output(&#34;eoe-modal&#34;, &#34;is_open&#34;),
              Output(&#34;eous-modal&#34;, &#34;is_open&#34;),
              Output(&#34;rand-step-btn-div&#34;, &#34;style&#34;),
              Output(&#34;reset-btn-div&#34;, &#34;style&#34;),
              Output(&#34;exp-progress-div&#34;, &#34;style&#34;),
              Output(&#39;study-progress-div&#39;, &#39;style&#39;),
              Output(&#39;download-btn&#39;, &#39;children&#39;),
              Output(&#39;content-legend-div&#39;, &#39;children&#39;),
              Output(&#39;qus-div&#39;, &#39;style&#39;),
              Output(&#34;eus-modal&#34;, &#34;is_open&#34;),
              Output(&#39;emitter-dropdown&#39;, &#39;label&#39;),
                            
              State(&#39;heatmap-plot&#39;, &#39;figure&#39;),
              State(&#39;hl-rules&#39;, &#39;value&#39;),
              State(&#39;content-plot&#39;, &#39;figure&#39;),
              State(&#39;content-string&#39;, &#39;value&#39;),
              State(&#39;spaceship-properties&#39;, &#39;children&#39;),
              State(&#39;population-dropdown&#39;, &#39;label&#39;),
              State(&#39;metric-dropdown&#39;, &#39;label&#39;),
              State(&#39;b0-dropdown&#39;, &#39;label&#39;),
              State(&#39;b1-dropdown&#39;, &#39;label&#39;),
              State(&#39;symmetry-dropdown&#39;, &#39;label&#39;),
              State(&#39;emitter-dropdown&#39;, &#39;label&#39;),
              State(&#34;quickstart-modal&#34;, &#34;is_open&#34;),
              State(&#34;quickstart-usermode-modal&#34;, &#34;is_open&#34;),
              State(&#34;consent-modal&#34;, &#34;is_open&#34;),
              State(&#34;nbs-err-modal&#34;, &#34;is_open&#34;),
              State(&#34;eoe-modal&#34;, &#34;is_open&#34;),
              State(&#34;eous-modal&#34;, &#34;is_open&#34;),
              State(&#34;rand-step-btn-div&#34;, &#34;style&#34;),
              State(&#34;reset-btn-div&#34;, &#34;style&#34;),
              State(&#34;exp-progress-div&#34;, &#34;style&#34;),
              State(&#39;study-progress-div&#39;, &#39;style&#39;),
              State(&#39;download-btn&#39;, &#39;children&#39;),
              State(&#39;content-legend-div&#39;, &#39;children&#39;),
              State(&#34;eus-modal&#34;, &#34;is_open&#34;),
              State(&#39;color-picker&#39;, &#39;value&#39;),
              State(&#34;content-plot&#34;, &#34;relayoutData&#34;),
              State(&#34;voxel-preview-toggle&#34;, &#34;value&#34;),
                            
              Input(&#39;population-feasible&#39;, &#39;n_clicks&#39;),
              Input(&#39;population-infeasible&#39;, &#39;n_clicks&#39;),
              Input(&#39;metric-fitness&#39;, &#39;n_clicks&#39;),
              Input(&#39;metric-age&#39;, &#39;n_clicks&#39;),
              Input(&#39;metric-coverage&#39;, &#39;n_clicks&#39;),
              Input(&#39;method-radio&#39;, &#39;value&#39;),
              Input(&#39;step-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;rand-step-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;reset-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;subdivide-btn&#39;, &#39;n_clicks&#39;),
              Input({&#39;type&#39;: &#39;fitness-sldr&#39;, &#39;index&#39;: ALL}, &#39;value&#39;),
              Input(&#39;bc0-Major-axis_Medium-axis&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc0-Major-axis_Smallest-axis&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc0-Average-Proportions&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc0-Symmetry&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc1-Major-axis_Medium-axis&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc1-Major-axis_Smallest-axis&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc1-Average-Proportions&#39;, &#39;n_clicks&#39;),
              Input(&#39;bc1-Symmetry&#39;, &#39;n_clicks&#39;),
              Input(&#39;lsystem-modules&#39;, &#39;value&#39;),
              Input(&#39;update-rules-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;heatmap-plot&#39;, &#39;clickData&#39;),
              Input(&#39;selection-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;selection-clr-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-human&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-random&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-greedy&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-prefmatrix&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-prefbandit&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-conbandit&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-knn&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-linkernel&#39;, &#39;n_clicks&#39;),
              Input(&#39;emitter-rbfkernel&#39;, &#39;n_clicks&#39;),
              Input(&#34;download-btn&#34;, &#34;n_clicks&#34;),
              Input(&#39;popdownload-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;popupload-data&#39;, &#39;filename&#39;),
              Input(&#39;symmetry-none&#39;, &#39;n_clicks&#39;),
              Input(&#39;symmetry-x&#39;, &#39;n_clicks&#39;),
              Input(&#39;symmetry-y&#39;, &#39;n_clicks&#39;),
              Input(&#39;symmetry-z&#39;, &#39;n_clicks&#39;),
              Input(&#39;symmetry-radio&#39;, &#39;value&#39;),
              Input(&#34;consent-yes&#34;, &#34;n_clicks&#34;),
              Input(&#34;consent-no&#34;, &#34;n_clicks&#34;),
              Input(&#34;nbs-err-btn&#34;, &#34;n_clicks&#34;),
              Input(&#39;color-picker-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;webapp-quickstart-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;qus-btn&#39;, &#39;n_clicks&#39;),
              Input(&#39;qus-y-btn&#39;, &#39;n_clicks&#39;),
              Input(&#34;voxel-preview-toggle&#34;, &#34;value&#34;),
              )
def general_callback(curr_heatmap, rules, curr_content, cs_string, cs_properties, pop_name, metric_name, b0, b1, symm_axis, emitter_name, qs_modal_show, qs_um_modal_show, cm_modal_show, nbs_err_modal_show, eoe_modal_show, eous_modal_show, rand_step_btn_style, reset_btn_style, exp_progress_style, study_style, dlbtn_label, curr_legend, eus_modal_show, color, curr_camera, curr_voxel_display,
                     pop_feas, pop_infeas, metric_fitness, metric_age, metric_coverage, method_name, n_clicks_step, n_clicks_rand_step, n_clicks_reset, n_clicks_sub, weights, b0_mame, b0_mami, b0_avgp, b0_sym, b1_mame, b1_mami, b1_avgp, b1_sym, modules, n_clicks_rules, clickData, selection_btn, clear_btn, emitter1_nclicks, emitter2_nclicks, emitter3_nclicks, emitter4_nclicks, emitter5_nclicks, emitter6_nclicks, emitter7_nclicks, emitter8_nclicks, emitter9_nclicks, n_clicks_cs_download, n_clicks_popdownload, upload_filename, symm_none, symm_x, symm_y, symm_z, symm_orientation, nclicks_yes, nclicks_no, nbs_btn, color_btn, qs_btn, qus_btn, qus_y_btn, switch_voxel_display):
    global app_settings
    
    ctx = dash.callback_context

    if not ctx.triggered:
        event_trig = None
    else:
        event_trig = ctx.triggered[0][&#39;prop_id&#39;].split(&#39;.&#39;)[0]

    if event_trig not in triggers_map:
        try:
            import ast
            event_trig = ast.literal_eval(event_trig)
            event_trig = event_trig[&#39;type&#39;]
        except ValueError:
            logging.getLogger(&#39;webapp&#39;).error(msg=f&#39;[{__name__}.general_callback] Unrecognized {event_trig=}. No operations have been applied!&#39;)
    
    vars = locals()
    
    output = {
        &#39;heatmap-plot.figure&#39;: curr_heatmap,
        &#39;content-plot.figure&#39;: curr_content,
        &#39;hl-rules.value&#39;: rules,
        &#39;selected-bin.children&#39;: &#39;&#39;,
        &#39;content-string.value&#39;: cs_string,
        &#39;spaceship-properties.children&#39;: cs_properties,
        &#39;step-spinner.children&#39;: &#39;&#39;,
        &#39;download-population.data&#39;: None,
        &#39;download-metrics.data&#39;: None,
        &#39;population-dropdown.label&#39;: pop_name,
        &#39;metric-dropdown.label&#39;: metric_name,
        &#39;b0-dropdown.label&#39;: b0,
        &#39;b1-dropdown.label&#39;: b1,
        &#39;symmetry-dropdown.label&#39;: symm_axis,
        &#39;quickstart-modal.is_open&#39;: qs_modal_show,
        &#39;quickstart-usermode-modal.is_open&#39;: qs_um_modal_show,
        &#39;consent-modal.is_open&#39;: cm_modal_show if app_settings.app_mode is not None else True,
        &#39;nbs-err-modal.is_open&#39;: nbs_err_modal_show,
        &#39;eoe-modal.is_open&#39;: eoe_modal_show,
        &#39;eous-modal.is_open&#39;: eous_modal_show,
        &#39;rand-step-btn-div.style&#39;: rand_step_btn_style,
        &#39;reset-btn-div.style&#39;: reset_btn_style,
        &#39;exp-progress-div.style&#39;: exp_progress_style,
        &#39;study-progress-div.style&#39;: study_style,
        &#39;download-btn.children&#39;: dlbtn_label,
        &#39;content-legend-div.children&#39;: curr_legend,
        &#39;qus-div.style&#39;: {&#39;text-align&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.USERSTUDY else hidden_style,
        &#39;eus-modal.is_open&#39;: eus_modal_show,
        &#39;emitter-dropdown.label&#39;: emitter_name
    }
    
    # logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.general_callback] {event_trig=}; {app_settings.exp_n=}; {app_settings.gen_counter=}; {app_settings.selected_bins=}; {app_settings.current_mapelites.emitter.name=}; {app_settings.current_mapelites.emitter.sampling_strategy=}; {process_semaphore.is_locked=}&#39;)
    logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.general_callback] {event_trig=}; {app_settings.exp_n=}; {app_settings.gen_counter=}; {app_settings.selected_bins=}; {app_settings.current_mapelites.emitter.name=}; {process_semaphore.is_locked=}&#39;)
    
    for metric in all_metrics:
        logging.getLogger(&#39;webapp&#39;).debug(f&#39;[{__name__}.general_callback] metric={metric.name}; {metric.history=}&#39;)
    
    if not process_semaphore.is_locked:
        process_semaphore.lock(name=event_trig)

        u = triggers_map[event_trig](**vars)
        for k in u.keys():
            output[k] = u[k]

        app_settings.selected_bins, selected_bins_str = _format_bins(mapelites=app_settings.current_mapelites,
                                                                     bins_idx_list=app_settings.selected_bins,
                                                                     do_switch=True,
                                                                     str_prefix=&#39;Selected bin(s):&#39;,
                                                                     filter_out_empty=True) 
        
        output[&#39;selected-bin.children&#39;] = selected_bins_str
        
        if app_settings.selected_bins and len(curr_content[&#39;data&#39;]) == 0:
            output[&#39;content-plot.figure&#39;] = _get_elite_content(mapelites=app_settings.current_mapelites,
                                                               bin_idx=_switch([app_settings.selected_bins[-1]])[0],
                                                               pop=&#39;feasible&#39;,
                                                               camera=curr_camera.get(&#39;scene.camera&#39;, None),
                                                               show_voxel=curr_voxel_display)
        
        process_semaphore.unlock()
    
    return tuple(output.values())</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.get_content_legend"><code class="name flex">
<span>def <span class="ident">get_content_legend</span></span>(<span>) ‑> dash_bootstrap_components._components.Row.Row</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_content_legend() -&gt; dbc.Row:
    return dbc.Row([
        dbc.Col(children=[
            html.Span(children=[
                html.P(&#39;&#39;, style={**circle_style,
                                  **{&#39;background-color&#39;: &#39;#%02x%02x%02x&#39; % base_color.scale(256).to_veci().as_tuple() if _is_base_block(block_type) else block_to_colour[block_type]}}),
                dbc.Label(block_type,
                          align=&#39;start&#39;,
                        #   style={&#39;text-overflow&#39;: &#39;ellipsis&#39;, &#39;text-align&#39;: &#39;left&#39;, &#39;font-size&#39;: &#39;x-small&#39;}
                          )],
                      style={&#39;display&#39;: &#39;inline-flex&#39;, &#39;align-items&#39;: &#39;baseline&#39;, &#39;font-size&#39;: &#39;x-small&#39;, &#39;text-align&#39;: &#39;left&#39;}
                      ),
            ],
                style={&#39;overflow&#39;: &#39;hidden&#39;, &#39;text-overflow&#39;: &#39;ellipsis&#39;, &#39;display&#39;: &#39;block&#39;, &#39;white-space&#39;: &#39;nowrap&#39;},
                width=3) for block_type in block_to_colour.keys()
        ],
                   justify=&#39;start&#39;)</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.get_properties_table"><code class="name flex">
<span>def <span class="ident">get_properties_table</span></span>(<span>cs: Optional[<a title="pcgsepy.lsystem.solution.CandidateSolution" href="../../lsystem/solution.html#pcgsepy.lsystem.solution.CandidateSolution">CandidateSolution</a>] = None) ‑> dash_bootstrap_components._components.Table.Table</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_properties_table(cs: Optional[CandidateSolution] = None) -&gt; dbc.Table:
    size = str(cs.size) if cs else &#39;-&#39; 
    nblocks = cs.n_blocks if cs else &#39;-&#39;
    vol = cs.content.total_volume if cs else &#39;-&#39;
    mass = cs.content.mass if cs else &#39;-&#39;
    struct_size = struct_sizes[cs.content.grid_size] if cs else &#39;-&#39;
    armor_blocks, non_armor_blocks = cs.content.blocks_count if cs else (&#39;-&#39;, &#39;-&#39;)
    cs_unique_blocks = cs.unique_blocks if cs else {}
    
    table_header = [
        html.Thead(html.Tr([html.Th(&#34;Property&#34;, style={&#39;text-align&#39;: &#39;center&#39;}),
                            html.Th(&#34;Value&#34;, style={&#39;text-align&#39;: &#39;center&#39;})]))
        ]
    table_body = [html.Tbody([
        html.Tr([html.Td(&#34;Spaceship size&#34;), html.Td(f&#39;{size} m&#39;, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Grid size&#34;), html.Td(struct_size, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Number of blocks&#34;), html.Td(nblocks, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Armor blocks&#34;), html.Td(armor_blocks, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Non-armor blocks&#34;), html.Td(non_armor_blocks, style={&#39;text-align&#39;: &#39;center&#39;})]),
        *[html.Tr([html.Td(k), html.Td(v, style={&#39;text-align&#39;: &#39;center&#39;})]) for k, v in cs_unique_blocks.items()],
        html.Tr([html.Td(&#34;Occupied volume&#34;), html.Td(f&#39;{vol} m³&#39;, style={&#39;text-align&#39;: &#39;center&#39;})]),
        html.Tr([html.Td(&#34;Spaceship mass&#34;), html.Td(f&#39;{mass} kg&#39;, style={&#39;text-align&#39;: &#39;center&#39;})]),
    ])]
    
    return table_header + table_body</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.interval_updates"><code class="name flex">
<span>def <span class="ident">interval_updates</span></span>(<span>fdis, ms, lsysms, symms, consent_loading_data_children, eous_loading_data_children, eus_loading_data_children, ni)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(Output(&#39;step-btn&#39;, &#39;disabled&#39;),
              Output(&#39;download-btn&#39;, &#39;disabled&#39;),
              Output(&#39;popdownload-btn&#39;, &#39;disabled&#39;),
              Output(&#39;rand-step-btn&#39;, &#39;disabled&#39;),
              Output(&#39;selection-clr-btn&#39;, &#39;disabled&#39;),
              Output(&#39;selection-btn&#39;, &#39;disabled&#39;),
              Output(&#39;reset-btn&#39;, &#39;disabled&#39;),
              Output(&#39;subdivide-btn&#39;, &#39;disabled&#39;),
              Output(&#39;download-mapelites-btn&#39;, &#39;disabled&#39;),
              Output(&#39;update-rules-btn&#39;, &#39;disabled&#39;),
              Output(&#39;popupload-data&#39;, &#39;disabled&#39;),
              Output(&#39;population-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;metric-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;method-radio&#39;, &#39;options&#39;),
              Output(&#39;b0-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;b1-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;lsystem-modules&#39;, &#39;options&#39;),
              Output(&#39;emitter-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;symmetry-dropdown&#39;, &#39;disabled&#39;),
              Output(&#39;symmetry-radio&#39;, &#39;options&#39;),
              Output(&#39;color-picker&#39;, &#39;disabled&#39;),
              Output(&#39;heatmap-plot-container&#39;, &#39;style&#39;),
              Output({&#39;type&#39;: &#39;fitness-sldr&#39;, &#39;index&#39;: ALL}, &#39;disabled&#39;),
              Output(&#39;qus-btn&#39;, &#39;disabled&#39;),
              Output(&#39;webapp-quickstart-btn&#39;, &#39;disabled&#39;),
              Output(&#39;webapp-info-btn&#39;, &#39;disabled&#39;),
              Output(&#39;ai-info-btn&#39;, &#39;disabled&#39;),
              Output(&#39;qus-y-btn&#39;, &#39;disabled&#39;),
              Output(&#39;consent-body-loading&#39;, &#39;children&#39;),
              Output(&#39;eous-body-loading&#39;, &#39;children&#39;),
              Output(&#39;eus-body-loading&#39;, &#39;children&#39;),
              Output(&#39;color-picker-btn&#39;, &#39;disabled&#39;),

              State({&#39;type&#39;: &#39;fitness-sldr&#39;, &#39;index&#39;: ALL}, &#39;disabled&#39;),
              State(&#39;method-radio&#39;, &#39;options&#39;),
              State(&#39;lsystem-modules&#39;, &#39;options&#39;),
              State(&#39;symmetry-radio&#39;, &#39;options&#39;),
              State(&#39;consent-body-loading&#39;, &#39;children&#39;),
              State(&#39;eous-body-loading&#39;, &#39;children&#39;),
              State(&#39;eus-body-loading&#39;, &#39;children&#39;),
                   
              Input(&#39;interval2&#39;, &#39;n_intervals&#39;),
              )
def interval_updates(fdis, ms, lsysms, symms, consent_loading_data_children, eous_loading_data_children, eus_loading_data_children,
                      ni):
    # non-definitive solution, see: https://github.com/plotly/dash-table/issues/925, https://github.com/plotly/dash/issues/1861
    # long_callback and background callback also do not work (infinite redeployment of webapp)
    global process_semaphore
    
    running_something = process_semaphore.is_locked
    
    for o in ms:
        o[&#39;disabled&#39;] = running_something
    for o in symms:
        o[&#39;disabled&#39;] = running_something
    for o in lsysms:
        o[&#39;disabled&#39;] = running_something
    
    btns = {
        &#39;step-btn.disabled&#39;: running_something or (app_settings.app_mode == AppMode.USERSTUDY and app_settings.gen_counter &gt;= N_GENS_ALLOWED),
        &#39;download-btn.disabled&#39;: running_something or download_semaphore._running == &#39;YES&#39;,
        &#39;popdownload-btn.disabled&#39;: running_something,
        &#39;rand-step-btn.disabled&#39;: running_something,
        &#39;selection-clr-btn.disabled&#39;: running_something,
        &#39;selection-btn.disabled&#39;: running_something,
        &#39;reset-btn.disabled&#39;: running_something,
        &#39;subdivide-btn.disabled&#39;: running_something,
        &#39;download-mapelites-btn.disabled&#39;: running_something,
        &#39;update-rules-btn.disabled&#39;: running_something,
        &#39;popupload-data.disabled&#39;: running_something,
        &#39;population-dropdown.disabled&#39;: running_something,
        &#39;metric-dropdown.disabled&#39;: running_something,
        &#39;method-radio.options&#39;: ms,
        &#39;b0-dropdown.disabled&#39;: running_something,
        &#39;b1-dropdown.disabled&#39;: running_something,
        &#39;lsystem-modules.options&#39;: lsysms,
        &#39;emitter-dropdown.disabled&#39;: running_something,
        &#39;symmetry-dropdown.disabled&#39;: running_something,
        &#39;symmetry-radio.options&#39;: symms,
        &#39;color-picker.disabled&#39;: running_something,
        &#39;heatmap-plot-container.style&#39;: {&#39;visibility&#39;: &#39;visible&#39; if running_something else &#39;hidden&#39;,
                                         &#39;display&#39;: &#39;grid&#39; if running_something else &#39;none&#39;,
                                        #  &#39;background&#39;: &#39;#ffffff11&#39;,  # decomment for debugging purposes
                                         &#39;pointer-events&#39;: &#39;auto&#39;,
                                         &#39;z-index&#39;: 1 if running_something else -1},
        &#39;fitness-sldr.disabled&#39;: [running_something] * len(fdis),
        &#39;qus-btn.disabled&#39;: running_something,
        &#39;webapp-quickstart-btn.disabled&#39;: running_something,
        &#39;webapp-info-btn.disabled&#39;: running_something,
        &#39;ai-info-btn.disabled&#39;: running_something,
        &#39;qus-y-btn.disabled&#39;: running_something,
        &#39;consent-body-loading.children&#39;: [],
        &#39;eous-body-loading.children&#39;: [],
        &#39;eus-body-loading.children&#39;: [],
        &#39;color-picker-btn.disabled&#39;: running_something,
    }
    
    if running_something and consent_loading_data_children == []:
        btns[&#39;consent-body-loading.children&#39;] = loading_data_component
    elif running_something and consent_loading_data_children != []:
        btns[&#39;consent-body-loading.children&#39;] = dash.no_update
    
    if running_something and eous_loading_data_children == []:
        btns[&#39;eous-body-loading.children&#39;] = loading_data_component
    elif running_something and eous_loading_data_children != []:
        btns[&#39;eous-body-loading.children&#39;] = dash.no_update
    
    if running_something and eus_loading_data_children == []:
        btns[&#39;eus-body-loading.children&#39;] = loading_data_component
    elif running_something and eus_loading_data_children != []:
        btns[&#39;eus-body-loading.children&#39;] = dash.no_update
    
    return tuple(btns.values())</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.resource_path"><code class="name flex">
<span>def <span class="ident">resource_path</span></span>(<span>relative_path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def resource_path(relative_path):
# get absolute path to resource
    try:
        # PyInstaller creates a temp folder and stores path in _MEIPASS
        base_path = sys._MEIPASS
    except Exception:
        base_path = os.path.abspath(&#34;.&#34;)
    return os.path.join(base_path, relative_path)</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.serve_layout"><code class="name flex">
<span>def <span class="ident">serve_layout</span></span>(<span>) ‑> dash_bootstrap_components._components.Container.Container</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def serve_layout() -&gt; dbc.Container:
    global app_settings
    
    if not app_settings.app_mode:
        app_settings.consent_ok = False if app_settings.app_mode == AppMode.DEV else None
    
    # check if user has completed the user study already
    if not app_settings.app_mode:
        if os.path.isfile(os.path.join(curr_folder, &#39;.userstudyover&#39;)):
            app_settings.consent_ok = False
            app_settings.app_mode = AppMode.USER
    
    
    webapp_info_file = &#39;./assets/webapp_help_dev.md&#39; if app_settings.app_mode == AppMode.DEV else &#39;./assets/webapp_info.md&#39;
    with open(webapp_info_file, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
        webapp_info_str = f.read()
        
    algo_info_file = &#39;./assets/algo_info.md&#39;
    with open(algo_info_file, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
        algo_info_str = f.read()
    
    quickstart_info_file = &#39;./assets/quickstart.md&#39;
    with open(quickstart_info_file, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
        quickstart_info_str = f.read()
    
    quickstart_usermode_info_file = &#39;./assets/quickstart_usermode.md&#39;
    with open(quickstart_usermode_info_file, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
        quickstart_usermode_info_str = f.read()
    
    if app_settings.rngseed is None:
        app_settings.rngseed = uuid.uuid4().int
        logging.getLogger(&#39;webapp&#39;).info(msg=f&#39;Your ID is {app_settings.rngseed}.&#39;)
    if app_settings.app_mode is None:
        random.seed(app_settings.rngseed)
        app_settings.my_emitterslist = MY_EMITTERS.copy()
        random.shuffle(app_settings.my_emitterslist)
        app_settings.current_mapelites.emitter = _get_emitter()
        logging.getLogger(&#39;webapp&#39;).debug(msg=f&#39;[{__name__}.set_app_layout] {app_settings.app_mode=} {app_settings.rngseed=}; {app_settings.my_emitterslist=}.&#39;)
        
    consent_dialog = dbc.Modal([
            dbc.ModalHeader(dbc.ModalTitle(&#34;Privacy Policy&#34;),
                            style={&#39;justify-content&#39;: &#39;center&#39;},
                            close_button=False),
            dbc.ModalBody(children=[
                html.Div(id=&#39;body-text&#39;,
                         children=[
                              dcc.Markdown(privacy_policy_body,
                                           link_target=&#34;_blank&#34;,
                                           style={&#39;text-align&#39;: &#39;justify&#39;}),
                              dcc.Markdown(privacy_policy_question,
                                           style={&#39;text-align&#39;: &#39;center&#39;})
                         ]),
                html.Div(id=&#39;consent-body-loading&#39;,
                         children=[])
            ]),
            dbc.ModalFooter(children=[
                dbc.Button(&#34;No&#34;,
                           disabled=False,
                           id=&#34;consent-no&#34;,
                           color=&#34;danger&#34;,
                           className=&#34;ms-auto&#34;,
                           n_clicks=0,
                           style={&#39;width&#39;: &#39;49%&#39;}),
                dbc.Button(&#34;Yes, and take me to the questionnaire&#34;,
                           disabled=False,
                           id=&#34;consent-yes&#34;,
                           color=&#34;success&#34;,
                           className=&#34;ms-auto&#34;,
                           n_clicks=0,
                           style={&#39;width&#39;: &#39;49%&#39;})
                ])
            ],
        id=&#34;consent-modal&#34;,
        centered=True,
        backdrop=&#34;static&#34;,
        keyboard=False,
        is_open=False)
    
    webapp_info_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;App Info&#34;),
                        style={&#39;flex-direction&#39;: &#39;column-reverse&#39;},
                        close_button=True),
        dbc.ModalBody(dcc.Markdown(webapp_info_str,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
        ],
                           id=&#39;webapp-info-modal&#39;,
                           centered=True,
                           backdrop=&#39;static&#39;,
                           is_open=False,
                           scrollable=True,
                           size=&#39;lg&#39;)
    
    algo_info_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;AI Info&#34;),
                        style={&#39;flex-direction&#39;: &#39;column-reverse&#39;},
                        close_button=True),
        dbc.ModalBody(dcc.Markdown(algo_info_str,
                                   style={&#39;text-align&#39;: &#39;justify&#39;},
                                   mathjax=True))
    ],
                           id=&#39;algo-info-modal&#39;,
                           centered=True,
                           backdrop=&#39;static&#39;,
                           is_open=False,
                           scrollable=True,
                           size=&#39;lg&#39;)
    
    quickstart_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Tutorial&#34;),
                        style={&#39;flex-direction&#39;: &#39;column-reverse&#39;},
                        close_button=True),
        dbc.ModalBody(dcc.Markdown(quickstart_info_str,
                                   link_target=&#34;_blank&#34;,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
    ],
                           id=&#39;quickstart-modal&#39;,
                           centered=True,
                           backdrop=&#39;static&#39;,
                           is_open=False,
                           scrollable=True,
                           size=&#39;lg&#39;)
    
    quickstart_usermode_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Tutorial&#34;),
                        style={&#39;flex-direction&#39;: &#39;column-reverse&#39;},
                        close_button=True),
        dbc.ModalBody(dcc.Markdown(quickstart_usermode_info_str,
                                   link_target=&#34;_blank&#34;,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
    ],
                           id=&#39;quickstart-usermode-modal&#39;,
                           centered=True,
                           backdrop=&#39;static&#39;,
                           is_open=False,
                           scrollable=True,
                           size=&#39;lg&#39;)

    no_bins_selected_modal = dbc.Modal(children=[
        dbc.ModalHeader(dbc.ModalTitle(&#34;⚠ Warning ⚠&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(no_selection_error),
        dbc.ModalFooter(children=[dbc.Button(&#34;Ok&#34;,
                                             id=&#34;nbs-err-btn&#34;,
                                             color=&#34;primary&#34;,
                                             className=&#34;ms-auto&#34;,
                                             n_clicks=0)]),
        ],
                                       id=&#39;nbs-err-modal&#39;,
                                       centered=True,
                                       backdrop=True,
                                       is_open=False)
    
    end_of_experiment_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;End of Generation&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(dcc.Markdown(end_of_experiment,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
    ],
                           id=&#39;eoe-modal&#39;,
                           centered=True,
                           backdrop=True,
                           is_open=False,
                           scrollable=True)
    
    end_of_userstudy_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;End of User Study&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(children=[
            dcc.Markdown(end_of_userstudy,
                         style={&#39;text-align&#39;: &#39;justify&#39;}),
            html.Div(id=&#39;eous-body-loading&#39;,
                     children=[])
            ])
        ],
                                       id=&#39;eous-modal&#39;,
                                       centered=True,
                                       backdrop=True,
                                       is_open=False,
                                       scrollable=True)
    
    heatmap_help_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Spaceship Population Help&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(dcc.Markdown(spaceship_population_help,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
        ],
                                   id=&#39;hh-modal&#39;,
                                   centered=True,
                                   backdrop=True,
                                   is_open=False,
                                   scrollable=True)
    
    content_help_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Selected Spaceship Help&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(dcc.Markdown(spaceship_preview_help,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
        ],
                                   id=&#39;ch-modal&#39;,
                                   centered=True,
                                   backdrop=True,
                                   is_open=False,
                                   scrollable=True)
    
    download_help_modal = dbc.Modal([
        dbc.ModalHeader(dbc.ModalTitle(&#34;Download Help&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=False),
        dbc.ModalBody(dcc.Markdown(download_help,
                                   style={&#39;text-align&#39;: &#39;justify&#39;}))
        ],
                                   id=&#39;dh-modal&#39;,
                                   centered=True,
                                   backdrop=True,
                                   is_open=False,
                                   scrollable=True)
    
    exit_userstudy_modal = dbc.Modal(children=[
        dbc.ModalHeader(dbc.ModalTitle(&#34;Quit User Study?&#34;),
                        style={&#39;justify-content&#39;: &#39;center&#39;},
                        close_button=True),
        dbc.ModalBody(children=[
            dcc.Markdown(user_study_quit_msg,
                         style={&#39;text-align&#39;: &#39;justify&#39;}),
            html.Div(id=&#39;eus-body-loading&#39;,
                     children=[])
        ]),       
        dbc.ModalFooter(children=[dbc.Button(&#34;Yes&#34;,
                                             id=&#34;qus-y-btn&#34;,
                                             color=&#34;primary&#34;,
                                             className=&#34;ms-auto&#34;,
                                             n_clicks=0,
                                             style={&#39;width&#39;: &#39;100%&#39;})])
        ],
                                     id=&#39;eus-modal&#39;,
                                     centered=True,
                                     backdrop=True,
                                     is_open=False,
                                     scrollable=True)
    
    modals = html.Div(children=[
        consent_dialog, webapp_info_modal, algo_info_modal, quickstart_modal, quickstart_usermode_modal,
        no_bins_selected_modal, end_of_experiment_modal, end_of_userstudy_modal, exit_userstudy_modal,
        heatmap_help_modal, content_help_modal, download_help_modal
    ])
    
    header = dbc.Row(children=[
                dbc.Col(html.H1(children=[
                    html.Span(children=&#39;Space Engineers&#39;),
                    html.Br(),
                    html.Span(children=&#39;🚀AI Spaceship Generator🚀&#39;)
                    ],
                                className=&#39;title&#39;),
                        width={&#39;size&#39;: 6,
                               &#39;offset&#39;: 3
                               },
                        style={
                            &#39;display&#39;: &#39;inline-flex&#39;,
                            &#39;flex-direction&#39;: &#39;column&#39;,
                            &#39;align-content&#39;: &#39;center&#39;,
                            &#39;justify-content&#39;: &#39;center&#39;,
                            &#39;align-items&#39;: &#39;center&#39;
                            }),
                dbc.Col(children=[
                    dbc.Row(children=[
                        dbc.Col(dbc.Button(&#39;Tutorial&#39;,
                                           className=&#39;button-fullsize&#39;,
                                           id=&#39;webapp-quickstart-btn&#39;,
                                           color=&#39;info&#39;),
                                width=4,
                                style=hidden_style if app_settings.app_mode == AppMode.DEV else {}),
                        dbc.Col(dbc.Button(&#39;App Info&#39;,
                                           className=&#39;button-fullsize&#39;,
                                           id=&#39;webapp-info-btn&#39;,
                                           color=&#39;info&#39;),
                                width=4),
                        dbc.Col(dbc.Button(&#39;AI Info&#39;,
                                           className=&#39;button-fullsize&#39;,
                                           id=&#39;ai-info-btn&#39;,
                                           color=&#39;info&#39;),
                                width=4)
                        ],
                            align=&#39;center&#39;)],
                        align=&#39;center&#39;, width=2)
    ],
                     className=&#39;header&#39;,
                     style={&#39;content-justify&#39;: &#39;center&#39;})
    
    quit_user_study_div = html.Div(
        dbc.Row(
                dbc.Col(children=[
                    dbc.Button(&#39;Quit User Study&#39;,
                               id=&#39;qus-btn&#39;,
                               className=&#39;button-fullsize&#39;,
                               color=&#39;danger&#39;),
                    html.Br(),
                    html.Br()],
                        width={&#39;size&#39;: 2, &#39;offset&#39;: 5}),
                id=&#39;qus-div&#39;,
                style={&#39;text-align&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.USERSTUDY else hidden_style
                )
    )
    
    exp_progress = html.Div(
        id=&#39;study-progress-div&#39;,
        children=[
            dbc.Row(
                dbc.Col(children=[
                    dbc.Label(f&#39;Current Iteration&#39;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                dbc.Progress(id=&#34;gen-progress&#34;,
                             color=&#39;success&#39;,
                             striped=False,
                             animated=False)
                ],
                        width={&#39;size&#39;: 12, &#39;offset&#39;: 0},
                        style={&#39;text-align&#39;: &#39;center&#39;},
                        align=&#39;center&#39;)
            ),
            
            dbc.Row(
                dbc.Col(children=[
                    dbc.Label(f&#39;Spaceships Generation Progress&#39;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                    dbc.Progress(id=&#34;exp-progress&#34;,
                                 color=&#39;success&#39;,
                                 striped=False,
                                 animated=False)
                ],
                        width={&#39;size&#39;: 12, &#39;offset&#39;: 0},
                        style={&#39;text-align&#39;: &#39;center&#39;} if app_settings.app_mode is None else {**{&#39;text-align&#39;: &#39;center&#39;}, **hidden_style},
                        align=&#39;center&#39;,
                        id=&#39;exp-progress-div&#39;)
            )
        ])
    
    mapelites_heatmap = html.Div(children=[
        
        html.Div(children=[
                html.H4(&#39;Spaceship Population&#39;,
                        className=&#39;section-title&#39;),
                dbc.Button(&#39;🛈&#39;,
                           color=&#39;info&#39;,
                           id=&#39;heatmap-help&#39;,
                           className=&#39;help&#39;),
                ],
                  style={
                      &#39;display&#39;: &#39;inline-flex&#39;,
                      &#39;flex-direction&#39;: &#39;row&#39;,
                      &#39;justify-content&#39;: &#39;center&#39;,
                      &#39;align-content&#39;: &#39;center&#39;,
                      &#39;align-items&#39;: &#39;center&#39;,
                      &#39;text-align&#39;: &#39;center&#39;
                      }),
        
        html.Br(),
        html.Div(className=&#39;container&#39;,
                 children=[
                     dcc.Graph(id=&#34;heatmap-plot&#34;,
                               figure=go.Figure(data=[]),
                               config={
                                   &#39;displayModeBar&#39;: False,
                                   &#39;displaylogo&#39;: False,
                                   &#39;scrollZoom&#39;: True},
                               className=&#39;content&#39;,
                               style={&#39;z-index&#39;: 0, &#39;overflow&#39;: &#39;auto&#39;}),
                     html.Div(id=&#39;heatmap-plot-container&#39;,
                              className=&#39;overlay&#39;,
                              style={&#39;visibility&#39;: &#39;hidden&#39;,
                                     &#39;display&#39;: &#39;none&#39;,
                                     &#39;pointer-events&#39;: &#39;auto&#39;,
                                     &#39;z-index&#39;: 1}),
                 ])
        ],
                                 style={&#39;text-align&#39;: &#39;center&#39;})
    
    mapelites_controls = html.Div(
        children=[
            html.H4(children=&#39;Plot Settings&#39;,
                    className=&#39;section-title&#39;),
            html.Br(),
            dbc.Label(&#39;Choose which population to display.&#39;),
            dbc.DropdownMenu(label=&#39;Feasible&#39;,
                            children=[
                                dbc.DropdownMenuItem(&#39;Feasible&#39;, id=&#39;population-feasible&#39;),
                                dbc.DropdownMenuItem(&#39;Infeasible&#39;, id=&#39;population-infeasible&#39;),
                            ],
                            id=&#39;population-dropdown&#39;),
            html.Br(),
            dbc.Label(&#39;Choose which metric to plot.&#39;),
            dbc.DropdownMenu(label=&#39;Fitness&#39;,
                            children=[
                                dbc.DropdownMenuItem(&#39;Fitness&#39;, id=&#39;metric-fitness&#39;),
                                dbc.DropdownMenuItem(&#39;Age&#39;, id=&#39;metric-age&#39;),
                                dbc.DropdownMenuItem(&#39;Coverage&#39;, id=&#39;metric-coverage&#39;),
                            ],
                            id=&#39;metric-dropdown&#39;),
            html.Br(),
            dbc.Label(&#39;Choose whether to compute the metric for the entire bin population or just the elite.&#39;),
            dbc.RadioItems(id=&#39;method-radio&#39;,
                        options=[
                            {&#39;label&#39;: &#39;Population&#39;, &#39;value&#39;: &#39;Population&#39;},
                            {&#39;label&#39;: &#39;Elite&#39;, &#39;value&#39;: &#39;Elite&#39;}
                        ],
                        value=&#39;Population&#39;)
            ],
        style=hidden_style if not app_settings.app_mode == AppMode.DEV else {})
    
    content_plot = html.Div(children=[
        
        html.Div(children=[
                html.H4(&#39;Selected Spaceship&#39;,
                        className=&#39;section-title&#39;),
                dbc.Button(&#39;🛈&#39;,
                           color=&#39;info&#39;,
                           id=&#39;content-help&#39;,
                           className=&#39;help&#39;)
            ],
                  style={
                      &#39;display&#39;: &#39;inline-flex&#39;,
                      &#39;flex-direction&#39;: &#39;row&#39;,
                      &#39;justify-content&#39;: &#39;center&#39;,
                      &#39;align-content&#39;: &#39;center&#39;,
                      &#39;align-items&#39;: &#39;center&#39;,
                      &#39;text-align&#39;: &#39;center&#39;
                      }),
        
        html.Br(),
        dcc.Graph(id=&#34;content-plot&#34;,
                  figure=go.Figure(data=[]),
                  config={
                      &#39;displayModeBar&#39;: False,
                      &#39;displaylogo&#39;: False},
                  style={&#39;overflow&#39;: &#39;auto&#39;}),
        html.Div(children=[
            dbc.Switch(
                    id=&#34;voxel-preview-toggle&#34;,
                    label=&#34;Toggle Voxel Preview&#34;,
                    value=False,
                )
            ],
                 style={&#39;display&#39;: &#39;inline-flex&#39;, &#39;justify-content&#39;: &#39;center&#39;}
                 ),
        html.Br(),
        dbc.Label(&#39;Legend&#39;,
                  size=&#39;sm&#39;),
        html.Div(children=[
            get_content_legend()
            ],
                 id=&#39;content-legend-div&#39;,
                 style={
                     &#39;text-align&#39;: &#39;start&#39;,
                     &#39;border-width&#39;: &#39;thin&#39;,
                     &#39;border-color&#39;: &#39;whitesmoke&#39;,
                     &#39;border-style&#39;: &#39;inset&#39;                     
                     })
        ],
                            style={&#39;text-align&#39;: &#39;center&#39;})
    
    color_and_download = html.Div(
        children=[
            dbc.Row(
                dbc.Col([
                    dbc.Label(&#34;Spaceship Color&#34;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                    dbc.Row(children=[
                        dbc.Col(
                            dbc.Input(type=&#34;color&#34;,
                                      id=&#34;color-picker&#34;,
                                      value=&#34;#737373&#34;,
                                      size=&#39;lg&#39;),
                            width=9
                            ),
                        dbc.Col(
                            dbc.Button(children=&#39;Apply&#39;,
                                       id=&#39;color-picker-btn&#39;,
                                       color=&#39;primary&#39;,
                                       class_name=&#39;button-fullsize&#39;),
                            width=3
                        )
                    ],
                            align=&#39;center&#39;)],
                        width={&#39;size&#39;: 6, &#39;offset&#39;: 3},
                        style={&#39;text-align&#39;: &#39;center&#39;})
            ),
            html.Br(),
            dbc.Row(
                dbc.Col([
                    dbc.Label(&#34;Download Blueprint&#34;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                    html.Br(),                   
                    dbc.Button(&#39;Download&#39;,
                               id=&#39;download-btn&#39;,
                               disabled=False),
                    dcc.Download(id=&#39;download-content&#39;),
                    html.Br(),
                    html.Br(),
                    dcc.Loading(id=&#39;download-spinner&#39;,
                                children=&#39;\n\n&#39;,
                                fullscreen=False,
                                color=&#39;#eeeeee&#39;,
                                type=&#39;default&#39;,
                                style={&#39;justify-content&#39;: &#39;center&#39;})
                    ],
                        width={&#39;size&#39;: 6, &#39;offset&#39;: 3},
                        style={&#39;text-align&#39;: &#39;center&#39;, &#39;justify-content&#39;: &#39;center&#39;})
            )
        ]
    )
    
    spaceship_controls = html.Div(
        dbc.Row(
            children=[dbc.Col(children=[
                html.Div(children=[
                    html.H4(children=&#39;Spaceship Controls&#39;,
                            className=&#39;section-title&#39;),
                    dbc.Button(&#39;🛈&#39;,
                               color=&#39;info&#39;,
                               id=&#39;download-help&#39;,
                               className=&#39;help&#39;)
                ],
                         style={&#39;display&#39;: &#39;inline-flex&#39;, &#39;flex-direction&#39;: &#39;row&#39;, &#39;justify-content&#39;: &#39;center&#39;, &#39;text-align&#39;: &#39;center&#39;}
                ),
                    
                    html.Br(),
                    color_and_download
                    ],
                              style={&#39;text-align&#39;: &#39;center&#39;})
            ]))
    
    content_properties = html.Div(
        children=[
            dbc.Row(children=[
                dbc.Col(children=[
                    dbc.Table(children=get_properties_table(),
                              id=&#39;spaceship-properties&#39;,
                              bordered=True,
                              color=&#39;dark&#39;,
                              hover=True,
                              size=&#39;sm&#39;,
                              responsive=True,
                              striped=True),
                    # TODO move Content String above High-level Rules (on the same row, so pushing it down)
                    html.Div([
                        html.P(children=&#39;Content String: &#39;),
                        dbc.Textarea(id=&#39;content-string&#39;,
                                    value=&#39;&#39;,
                                    contentEditable=False,
                                    disabled=True,
                                    class_name=&#39;content-string-area&#39;)
                        ],
                            style={} if app_settings.app_mode == AppMode.DEV else hidden_style)
                    ],
                        style={
                            &#39;max-height&#39;: &#39;30vh&#39;,
                            &#39;overflow&#39;: &#39;auto&#39;
                            })],
                    align=&#39;center&#39;)])    
   
    log = html.Div(
        children=[
            html.H4(children=&#39;Log&#39;,
                    className=&#39;section-title&#39;),
            html.Br(),
            dbc.Textarea(id=&#39;console-out&#39;,
                         value=&#39;&#39;,
                         wrap=False,
                         contentEditable=False,
                         disabled=True,
                         className=&#39;log-area&#39;),
            ])
    
    properties_panel = html.Div(
        children=[
            dbc.Row(
                dbc.Col([
                    html.H4(&#39;Spaceship Properties&#39;,
                            className=&#39;section-title&#39;),
                    html.Br()
                    ])),
            dbc.Row(
                      [
                          dbc.Col(content_properties)
                      ]
                  ),
            ]
    )
    
    experiment_settings = html.Div(
        children=[
            html.H4(children=&#39;Experiment Settings&#39;,
                    className=&#39;section-title&#39;),
            html.Br(),
            html.Div(children=[
                html.P(children=f&#39;Selected bin(s): {app_settings.selected_bins}&#39;,
                       id=&#39;selected-bin&#39;)
                ]),
            html.Br(),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Feature Descriptors (X, Y):&#39;),
                dbc.DropdownMenu(label=app_settings.current_mapelites.b_descs[0].name,
                             children=[
                                 dbc.DropdownMenuItem(b.name, id=f&#34;bc0-{b.name.replace(&#39; / &#39;, &#39;_&#39;).replace(&#39; &#39;, &#39;-&#39;)}&#34;)
                                 for b in app_settings.behavior_descriptors],
                             id=&#39;b0-dropdown&#39;),
                dbc.DropdownMenu(label=app_settings.current_mapelites.b_descs[1].name,
                             children=[
                                 dbc.DropdownMenuItem(b.name, id=f&#34;bc1-{b.name.replace(&#39; / &#39;, &#39;_&#39;).replace(&#39; &#39;, &#39;-&#39;)}&#34;)
                                 for b in app_settings.behavior_descriptors],
                             id=&#39;b1-dropdown&#39;)
                ],
                           className=&#34;mb-3&#34;,
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Toggle L-system Modules:&#39;),
                dbc.Checklist(id=&#39;lsystem-modules&#39;,
                              options=[{&#39;label&#39;: x.name, &#39;value&#39;: x.name} for x in app_settings.current_mapelites.lsystem.modules],
                              value=[x.name for x in app_settings.current_mapelites.lsystem.modules if x.active],
                              inline=True,
                              switch=True)
                ],
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style,
                           className=&#34;mb-3&#34;),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Fitness Weights:&#39;),
                html.Div(children=[
                    html.Div(children=[
                        dbc.Label(children=f.name,
                                  style={&#39;font-size&#39;: &#39;large&#39;}),
                        html.Div(children=[
                            dcc.Slider(min=0,
                                       max=1,
                                       step=0.1,
                                       value=1,
                                       marks=None,
                                       tooltip={&#34;placement&#34;: &#34;bottom&#34;,
                                                &#34;always_visible&#34;: False},
                                       id={&#39;type&#39;: &#39;fitness-sldr&#39;,
                                           &#39;index&#39;: i})
                        ],
                                 )
                        ]) for i, f in enumerate(app_settings.current_mapelites.feasible_fitnesses)
                    ])
                ],
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style,
                           className=&#34;mb-3&#34;),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Select Emitter:&#39;),
                dbc.DropdownMenu(label=&#39;Random&#39;,
                                 children=[
                                     dbc.DropdownMenuItem(&#39;Human&#39;, id=&#39;emitter-human&#39;),
                                     dbc.DropdownMenuItem(&#39;Random&#39;, id=&#39;emitter-random&#39;),
                                     dbc.DropdownMenuItem(&#39;Greedy&#39;, id=&#39;emitter-greedy&#39;),
                                     dbc.DropdownMenuItem(&#39;Preference Matrix&#39;, id=&#39;emitter-prefmatrix&#39;),
                                     dbc.DropdownMenuItem(&#39;Preference Bandit&#39;, id=&#39;emitter-prefbandit&#39;),
                                     dbc.DropdownMenuItem(&#39;Contextual Bandit&#39;, id=&#39;emitter-conbandit&#39;),
                                     dbc.DropdownMenuItem(&#39;KNN&#39;, id=&#39;emitter-knn&#39;),
                                     dbc.DropdownMenuItem(&#39;Linear Kernel&#39;, id=&#39;emitter-linkernel&#39;),
                                     dbc.DropdownMenuItem(&#39;RBF Kernel&#39;, id=&#39;emitter-rbfkernel&#39;)
                                     ],
                                 id=&#39;emitter-dropdown&#39;)
                ],
                           className=&#34;mb-3&#34;,
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Enforce Symmetry:&#39;),
                dbc.DropdownMenu(label=&#39;None&#39;,
                             children=[
                                 dbc.DropdownMenuItem(&#39;None&#39;, id=&#39;symmetry-none&#39;),
                                 dbc.DropdownMenuItem(&#39;X-axis&#39;, id=&#39;symmetry-x&#39;),
                                 dbc.DropdownMenuItem(&#39;Y-axis&#39;, id=&#39;symmetry-y&#39;),
                                 dbc.DropdownMenuItem(&#39;Z-axis&#39;, id=&#39;symmetry-z&#39;),
                             ],
                             id=&#39;symmetry-dropdown&#39;,
                             style={} if app_settings.app_mode == AppMode.DEV else hidden_style),
                dbc.RadioItems(id=&#39;symmetry-radio&#39;,
                        options=[
                            {&#39;label&#39;: &#39;Upper&#39;, &#39;value&#39;: &#39;Upper&#39;},
                            {&#39;label&#39;: &#39;Lower&#39;, &#39;value&#39;: &#39;Lower&#39;}
                        ],
                        value=&#39;Upper&#39;)
                ],
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style,
                           className=&#34;mb-3&#34;),
            dbc.InputGroup(children=[
                dbc.InputGroupText(&#39;Save/Load Population:&#39;),
                dbc.Button(id=&#39;popdownload-btn&#39;,
                           children=&#39;Download Current Population&#39;),
                dcc.Upload(
                    id=&#39;popupload-data&#39;,
                    children=&#39;Upload Population&#39;,
                    className=&#39;upload&#39;,
                    multiple=False
                    ),
                ],
                           className=&#34;mb-3&#34;,
                           style={} if app_settings.app_mode == AppMode.DEV else hidden_style)
            ],
        style={} if app_settings.app_mode == AppMode.DEV else hidden_style)
    
    experiment_controls = html.Div(
        children=[
            html.H4(&#39;Population Controls&#39;,
                    className=&#39;section-title&#39;),
            dbc.Row(children=[
                html.Br(),
                dbc.Col(children=[
                    dbc.Button(id=&#39;step-btn&#39;,
                               children=&#39;Evolve From Selected Spaceship&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        id=&#39;step-btn-div&#39;,
                        width=6),
                dbc.Col(children=[
                    dbc.Button(id=&#39;rand-step-btn&#39;,
                               children=&#39;Evolve From Random Spaceship&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        id=&#39;rand-step-btn-div&#39;,
                        style={} if app_settings.app_mode == AppMode.USER else hidden_style,
                        width=6)
                ],
                    style={&#39;justify-content&#39;: &#39;center&#39;, &#39;flex-wrap&#39;: &#39;inherit&#39;}),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;selection-clr-btn&#39;,
                               children=&#39;Clear Selection&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        width=6)],
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.DEV else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style}),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;selection-btn&#39;,
                               children=&#39;Toggle Single Bin Selection&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        width=6)],
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.DEV else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style}),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;reset-btn&#39;,
                               children=&#39;Reinitialize Population&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        id=&#39;reset-btn-div&#39;,
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.USER else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style},
                        width={&#39;offset&#39;: 3, &#39;size&#39;: 6})]),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;subdivide-btn&#39;,
                               children=&#39;Subdivide Selected Bin(s)&#39;,
                               className=&#39;button-fullsize&#39;)
                    ],
                        width=6)],
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.DEV else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style}),
            dbc.Row(children=[
                dbc.Col(children=[
                    html.Br(),
                    dbc.Button(id=&#39;download-mapelites-btn&#39;,
                               children=&#39;Download MAP-Elites&#39;,
                               className=&#39;button-fullsize&#39;),
                    dcc.Download(id=&#39;download-mapelites&#39;)
                    ],
                        width=6)],
                        style={&#39;justify-content&#39;: &#39;center&#39;} if app_settings.app_mode == AppMode.DEV else {**{&#39;justify-content&#39;: &#39;center&#39;}, **hidden_style}),
        ])
    
    rules = html.Div(
        children=[
            html.H4(children=&#39;High-level Rules&#39;,
                    className=&#39;section-title&#39;),
            html.Br(),
            dbc.Textarea(id=&#39;hl-rules&#39;,
                         value=str(app_settings.current_mapelites.lsystem.hl_solver.parser.rules),
                         wrap=False,
                         className=&#39;rules-area&#39;),
            dbc.Row(
                dbc.Col(dbc.Button(children=&#39;Update High-level Rules&#39;,
                                   id=&#39;update-rules-btn&#39;),
                        width={&#39;size&#39;: 4, &#39;offset&#39;:4}),
                align=&#39;center&#39;)
            ],
        style={} if app_settings.app_mode == AppMode.DEV else hidden_style)
    
    progress = html.Div(
        children=[
            dbc.Row(
                dbc.Col(children=[
                    dbc.Label(&#39;Evolution Progress&#39;,
                              style={&#39;font-size&#39;: &#39;large&#39;}),
                    dbc.Progress(id=&#34;step-progress&#34;,
                                 color=&#39;info&#39;,
                                 striped=True,
                                 animated=True)
                ],
                        align=&#39;center&#39;,
                        style={&#39;text-align&#39;: &#39;center&#39;})
            )
        ],
        id=&#39;step-progress-div&#39;,
        style={&#39;content-visibility&#39;: &#39;visible&#39; if 0 &lt;= app_settings.step_progress &lt;= 100 else &#39;hidden&#39;,
               &#39;display&#39;: &#39;inline-block&#39; if 0 &lt;= app_settings.step_progress &lt;= 100 else &#39;none&#39;,
               &#39;width&#39;: &#39;100%&#39;})
    
    load_spinner = html.Div(children=[
        dbc.Row(
            dbc.Col(children=[
                dcc.Loading(id=&#39;step-spinner&#39;,
                            children=&#39;&#39;,
                            fullscreen=False,
                            color=&#39;#eeeeee&#39;,
                            type=&#39;circle&#39;)
            ],
                )
        )
        
    ])
    
    intervals = html.Div(
        children=[
            dcc.Interval(id=&#39;interval1&#39;,
                         interval=1 * 1000,
                         n_intervals=0),
            dcc.Interval(id=&#39;interval2&#39;,
                         interval=1 * 10,
                         n_intervals=0)
        ]
    )
    
    return dbc.Container(
        children=[
            modals,
            header,
            dbc.Row(children=[
                dbc.Row(children=[
                    quit_user_study_div
                ]),
                dbc.Row(children=[
                    dbc.Col(children=[
                        exp_progress,
                        progress
                        ],
                            width={&#39;offset&#39;: 4, &#39;size&#39;: 4}
                    ),
                    dbc.Col(children=[
                        load_spinner
                    ],
                            align=&#39;center&#39;,
                            width=3)
                ])
            ]),
            html.Br(),
            html.Br(),
            dbc.Row(children=[
                dbc.Col(mapelites_heatmap, width={&#39;size&#39;: 3, &#39;offset&#39;: 1}, style={&#39;overflow&#39;: &#39;auto&#39;}),
                dbc.Col(content_plot, width=4, style={&#39;overflow&#39;: &#39;auto&#39;}),
                dbc.Col(properties_panel, width=3)],
                    align=&#34;start&#34;, style={&#39;overflow&#39;: &#39;auto&#39;}),
            html.Br(),
            html.Br(),
            dbc.Row(children=[
                dbc.Col(children=[mapelites_controls,
                                  experiment_controls],
                        width={&#39;size&#39;: 3, &#39;offset&#39;: 1}),
                dbc.Col(children=[
                    spaceship_controls,
                    experiment_settings],
                        width=4),
                dbc.Col(children=[log,
                                  rules,
                                  intervals
                                  ],
                        width=3)],
                    align=&#34;start&#34;),
            
            dcc.Download(id=&#39;download-population&#39;),
            dcc.Download(id=&#39;download-metrics&#39;),
            
            html.Div(id=&#39;hidden-div&#39;,
                     children=[],
                     style=hidden_style)
            ],
        fluid=True)</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.show_algo_info"><code class="name flex">
<span>def <span class="ident">show_algo_info</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    Output(&#34;algo-info-modal&#34;, &#34;is_open&#34;),
    Input(&#34;ai-info-btn&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_algo_info(n):
    return True</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.show_content_help"><code class="name flex">
<span>def <span class="ident">show_content_help</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    Output(&#34;ch-modal&#34;, &#34;is_open&#34;),
    Input(&#34;content-help&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_content_help(n):
    return True</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.show_download_help"><code class="name flex">
<span>def <span class="ident">show_download_help</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    Output(&#34;dh-modal&#34;, &#34;is_open&#34;),
    Input(&#34;download-help&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_download_help(n):
    return True</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.show_heatmap_help"><code class="name flex">
<span>def <span class="ident">show_heatmap_help</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    Output(&#34;hh-modal&#34;, &#34;is_open&#34;),
    Input(&#34;heatmap-help&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_heatmap_help(n):
    return True</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.show_webapp_info"><code class="name flex">
<span>def <span class="ident">show_webapp_info</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    Output(&#34;webapp-info-modal&#34;, &#34;is_open&#34;),
    Input(&#34;webapp-info-btn&#34;, &#34;n_clicks&#34;),
    prevent_initial_call=True
)
def show_webapp_info(n):
    return True</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.update_exp_progress"><code class="name flex">
<span>def <span class="ident">update_exp_progress</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    [Output(&#34;exp-progress&#34;, &#34;value&#34;),
     Output(&#34;exp-progress&#34;, &#34;label&#34;)],
    [Input(&#34;interval1&#34;, &#34;n_intervals&#34;)],
    prevent_initial_call=True
)
def update_exp_progress(n):
    val = min(100, np.round(100 * ((1 + app_settings.exp_n) / len(app_settings.my_emitterslist)), 2))
    return val, f&#34;{min(app_settings.exp_n + 1, len(app_settings.my_emitterslist))} / {len(app_settings.my_emitterslist)}&#34;</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.update_gen_progress"><code class="name flex">
<span>def <span class="ident">update_gen_progress</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    [Output(&#34;gen-progress&#34;, &#34;value&#34;),
     Output(&#34;gen-progress&#34;, &#34;label&#34;)],
    [Input(&#34;interval1&#34;, &#34;n_intervals&#34;)],
    prevent_initial_call=True
)
def update_gen_progress(n):
    if app_settings.app_mode != AppMode.DEV:
        val = np.round(100 * ((app_settings.gen_counter) / N_GENS_ALLOWED), 2)
        return val, f&#34;{app_settings.gen_counter} / {N_GENS_ALLOWED}&#34;
    else:
        return 100, f&#34;{app_settings.gen_counter}&#34;</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.update_output"><code class="name flex">
<span>def <span class="ident">update_output</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(Output(&#39;console-out&#39;, &#39;value&#39;),
              Input(&#39;interval1&#39;, &#39;n_intervals&#39;),
              prevent_initial_call=True)
def update_output(n):
    return (&#39;\n&#39;.join(dashLoggerHandler.queue))</code></pre>
</details>
</dd>
<dt id="pcgsepy.guis.main_webapp.webapp.update_progress"><code class="name flex">
<span>def <span class="ident">update_progress</span></span>(<span>n)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.callback(
    [Output(&#34;step-progress&#34;, &#34;value&#34;),
     Output(&#34;step-progress&#34;, &#34;label&#34;),
     Output(&#39;step-progress-div&#39;, &#39;style&#39;)],
    [Input(&#34;interval1&#34;, &#34;n_intervals&#34;)],
    prevent_initial_call=True
)
def update_progress(n):  
    return app_settings.step_progress, f&#34;{np.round(app_settings.step_progress, 2)}%&#34;, {&#39;content-visibility&#39;: &#39;visible&#39; if 0 &lt;= app_settings.step_progress &lt;= 100 else &#39;hidden&#39;,
                                                                                       &#39;display&#39;: &#39;inline-block&#39; if 0 &lt;= app_settings.step_progress &lt;= 100 else &#39;none&#39;,
                                                                                       &#39;width&#39;: &#39;100%&#39;}</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pcgsepy.guis.main_webapp" href="index.html">pcgsepy.guis.main_webapp</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pcgsepy.guis.main_webapp.webapp.disable_privacy_modal" href="#pcgsepy.guis.main_webapp.webapp.disable_privacy_modal">disable_privacy_modal</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.download_content" href="#pcgsepy.guis.main_webapp.webapp.download_content">download_content</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.download_mapelites" href="#pcgsepy.guis.main_webapp.webapp.download_mapelites">download_mapelites</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.general_callback" href="#pcgsepy.guis.main_webapp.webapp.general_callback">general_callback</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.get_content_legend" href="#pcgsepy.guis.main_webapp.webapp.get_content_legend">get_content_legend</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.get_properties_table" href="#pcgsepy.guis.main_webapp.webapp.get_properties_table">get_properties_table</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.interval_updates" href="#pcgsepy.guis.main_webapp.webapp.interval_updates">interval_updates</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.resource_path" href="#pcgsepy.guis.main_webapp.webapp.resource_path">resource_path</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.serve_layout" href="#pcgsepy.guis.main_webapp.webapp.serve_layout">serve_layout</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.show_algo_info" href="#pcgsepy.guis.main_webapp.webapp.show_algo_info">show_algo_info</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.show_content_help" href="#pcgsepy.guis.main_webapp.webapp.show_content_help">show_content_help</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.show_download_help" href="#pcgsepy.guis.main_webapp.webapp.show_download_help">show_download_help</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.show_heatmap_help" href="#pcgsepy.guis.main_webapp.webapp.show_heatmap_help">show_heatmap_help</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.show_webapp_info" href="#pcgsepy.guis.main_webapp.webapp.show_webapp_info">show_webapp_info</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.update_exp_progress" href="#pcgsepy.guis.main_webapp.webapp.update_exp_progress">update_exp_progress</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.update_gen_progress" href="#pcgsepy.guis.main_webapp.webapp.update_gen_progress">update_gen_progress</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.update_output" href="#pcgsepy.guis.main_webapp.webapp.update_output">update_output</a></code></li>
<li><code><a title="pcgsepy.guis.main_webapp.webapp.update_progress" href="#pcgsepy.guis.main_webapp.webapp.update_progress">update_progress</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>